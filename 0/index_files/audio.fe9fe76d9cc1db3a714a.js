/*! For license information please see audio.fe9fe76d9cc1db3a714a.js.LICENSE.txt */
(self.webpackChunkvk=self.webpackChunkvk||[]).push([[2805],{32911:function(e,t,i){"use strict";i.d(t,{audioRepeat:function(){return a}});var a={NONE:0,ALL:1,ONE:2}},77660:function(e,t,i){"use strict";function a(e,t){function i(e){var t=["Webkit","Moz","O","ms"],i=document.createElement("div");if(void 0!==i.style[e])return!0;for(var a in e=e.charAt(0).toUpperCase()+e.slice(1),t)if(void 0!==i.style[t[a]+e])return!0;return!1}function a(e,t){new RegExp("(\\s|^)"+t+"(\\s|$)").test(e.className)||(e.className+=" "+t)}function n(e,t){e.className=e.className.replace(new RegExp("(\\s+|^)"+t+"(\\s+|$)","g")," ").replace(/^\s+|\s+$/g,"")}function o(e,t){0>e?e=0:e>y-1&&(e=y-1);for(var i=P.dots.length-1;i>=0;i--)n(P.dots[i],S.activeDot);return a(P.dots[e],S.activeDot),C=e,r(-e*P.width,void 0===t?T.speed:t),_(),T.onSlideChange&&T.onSlideChange(e),e}function r(e,t){var i=t?t+"ms":"";E.style.webkitTransitionDuration=E.style.MozTransitionDuration=E.style.msTransitionDuration=E.style.OTransitionDuration=E.style.transitionDuration=i,u(e)}function l(e,t){if(I&&clearInterval(I),t){var i=+new Date,a=P.left;I=setInterval((function(){function n(e,t){return(t-e)*r+e}var s,o,r=(+new Date-i)/t,l=[0,.7,1,1];return r>=1?(u(e),void clearInterval(I)):(s=e-a,o=n(n(n(l[0],l[1]),n(l[1],l[2])),n(n(l[1],l[2]),n(l[2],l[3]))),void u(Math.floor(o*s+a)))}),15)}else u(e)}function u(e){E.style.webkitTransform="translate("+e+"px,0) translateZ(0)",E.style.msTransform=E.style.MozTransform=E.style.OTransform=E.style.transform="translateX("+e+"px)",P.left=e}function d(e){E.style.left=e+"px",P.left=e}function c(){var e=C+1;return e>y-1&&(e=0),o(e)}function h(){w=!0,_()}function _(){w&&(A&&clearTimeout(A),A=setTimeout((function(){c()}),T.slideshowInterval))}function p(){A&&clearTimeout(A)}function f(){w=!1,A&&clearTimeout(A)}function v(){P.width=e.offsetWidth,E.style.width=P.width*y+"px";for(var t=0;y>t;t++)P.slides[t].style.width=P.width+"px";r(-C*P.width)}function g(e,t,i,a){t&&(e.addEventListener?e.addEventListener(t,i,!!a):e.attachEvent("on"+t,i))}var y,m,E,A,w,I,P={slides:[],dots:[],left:0},b=200,C=0,T={speed:300,touchSpeed:300,slideshow:!1,slideshowInterval:4e3,stopSlideshowAfterInteraction:!1,startSlide:0,mouseDrag:!0,disableIfOneSlide:!0,cssPrefix:"peppermint-",dots:!1,dotsPrepend:!1,dotsContainer:void 0,slidesContainer:void 0,onSlideChange:void 0,onSetup:void 0};t&&function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}(T,t);var S={inactive:T.cssPrefix+"inactive",active:T.cssPrefix+"active",mouse:T.cssPrefix+"mouse",drag:T.cssPrefix+"drag",slides:T.cssPrefix+"slides",dots:T.cssPrefix+"dots",activeDot:T.cssPrefix+"active-dot",mouseClicked:T.cssPrefix+"mouse-clicked"},k={transforms:i("transform"),transitions:i("transition")};return function(){var t=T.slidesContainer||e,i=T.dotsContainer||e;if(!(T.disableIfOneSlide&&t.children.length<=1)){(!k.transforms||window.opera)&&(u=d),(!k.transitions||window.opera)&&(r=l),a(E=T.slidesContainer||document.createElement("div"),S.slides);for(var c=0,_=t.children.length;_>c;c++){var A=t.children[c],w=document.createElement("li");P.slides.push(A),w.setAttribute("tabindex","0"),w.setAttribute("role","button"),w.innerHTML="<span></span>",function(t,i){g(i,"click",(function(){o(t),T.stopSlideshowAfterInteraction&&f()})),g(i,"keyup",(function(e){13==e.keyCode&&(o(t),T.stopSlideshowAfterInteraction&&f())})),g(i,"mouseup",(function(){a(i,S.mouseClicked)})),g(i,"blur",(function(){n(i,S.mouseClicked)}),!0),g(A,"focus",A.onfocusin=function(){e.scrollLeft=0,setTimeout((function(){e.scrollLeft=0}),0),o(t)},!0)}(c,w),P.dots.push(w)}y=P.slides.length,100/y,a(e,S.active),n(e,S.inactive),T.mouseDrag&&a(e,S.mouse),P.width=e.offsetWidth,E.style.width=P.width*y+"px";for(c=0;y>c;c++)P.slides[c].style.width=P.width+"px",E.appendChild(P.slides[c]);if(T.slidesContainer||e.appendChild(E),T.dots&&y>1){a(m=document.createElement("ul"),S.dots);for(c=0,_=P.dots.length;_>c;c++)m.appendChild(P.dots[c]);T.dotsPrepend?i.insertBefore(m,i.firstChild):i.appendChild(m)}g(window,"resize",v),g(window,"orientationchange",v),setTimeout((function(){o(T.startSlide,0)}),0),T.slideshow&&h(),s(E,{mouse:T.mouseDrag,start:function(){a(e,S.drag)},move:function(e,t,i){p(),i.x=i.x/(!C&&i.x>0||C==y-1&&i.x<0?Math.abs(i.x)/P.width*2+1:1),r(i.x-P.width*C)},end:function(t,i,a){if(a.x){var s=Math.abs(a.x)/P.width,r=Math.floor(s)+(s-Math.floor(s)>.25?1:0);r+=a.time<b+b*r/1.8&&Math.abs(a.x)-r*P.width>(r?-P.width/9:20)?1:0,a.x<0?o(C+r,T.touchSpeed):o(C-r,T.touchSpeed),T.stopSlideshowAfterInteraction&&f()}n(e,S.drag)}}),setTimeout((function(){T.onSetup&&T.onSetup(y)}),0)}}(),{slideTo:function(e,t){return o(parseInt(e,10),t)},next:c,prev:function(){var e=C-1;return 0>e&&(e=y-1),o(e)},start:h,stop:f,pause:p,getCurrentPos:function(){return C},getSlidesNumber:function(){return y},recalcWidth:v}}var n;function s(e,t){function i(e,t,i,n){return t?(e.addEventListener?e.addEventListener(t,i,!!n):e.attachEvent("on"+t,i),{remove:function(){a(e,t,i,n)}}):void 0}function a(e,t,i,a){t&&(e.removeEventListener?e.removeEventListener(t,i,!!a):e.detachEvent("on"+t,i))}function n(e){}function s(e){if((v={x:(h?e.clientX:e.touches[0].clientX)-f.x,y:(h?e.clientY:e.touches[0].clientY)-f.y,time:Number(new Date)-f.time}).time-y[y.length-1].time){for(var t=0;t<y.length-1&&v.time-y[t].time>80;t++);g={x:(v.x-y[t].x)/(v.time-y[t].time),y:(v.y-y[t].y)/(v.time-y[t].time)},y.length>=5&&y.shift(),y.push({x:v.x,y:v.y,time:v.time})}}function o(e,t){E=!0,I[h=t](e)||(i(document,w[h][1],r),i(document,w[h][2],l),i(document,w[h][3],l),d.preventDefault,f={x:h?e.clientX:e.touches[0].clientX,y:h?e.clientY:e.touches[0].clientY,time:Number(new Date)},c=void 0,v={x:0,y:0,time:0},g={x:0,y:0},y=[{x:0,y:0,time:0}],d.start(e,f))}function r(e){!d.preventScroll&&c||I[h](e)||(s(e),(Math.abs(v.x)>d.clickTolerance||Math.abs(v.y)>d.clickTolerance)&&(E=!1),void 0===c&&3!==h&&(c=Math.abs(v.x)<Math.abs(v.y)&&!d.preventScroll)||(d.preventDefault,d.move(e,f,v,g)))}function l(e){h&&s(e),!E&&e.target&&e.target.blur&&e.target.blur(),a(document,w[h][1],r),a(document,w[h][2],l),a(document,w[h][3],l),d.end(e,f,v,g)}var u=function(){},d={preventDefault:!0,clickTolerance:0,preventScroll:!1,mouse:!0,start:u,move:u,end:u,click:u};t&&function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}(d,t);var c,h,_=!!window.navigator.pointerEnabled,p=!!window.navigator.msPointerEnabled,f={},v={},g={},y=[],m=[],E=!0,A=_?1:p?2:0,w=[["touchstart","touchmove","touchend","touchcancel"],["pointerdown","pointermove","pointerup","pointercancel"],["MSPointerDown","MSPointerMove","MSPointerUp","MSPointerCancel"],["mousedown","mousemove","mouseup",!1]],I=[function(e){return e.touches&&e.touches.length>1||e.scale&&1!==e.scale},function(e){return!e.isPrimary||e.buttons&&1!==e.buttons||!d.mouse&&"touch"!==e.pointerType&&"pen"!==e.pointerType},function(e){return!e.isPrimary||e.buttons&&1!==e.buttons||!d.mouse&&e.pointerType!==e.MSPOINTER_TYPE_TOUCH&&e.pointerType!==e.MSPOINTER_TYPE_PEN},function(e){return e.buttons&&1!==e.buttons}];return m.push(i(e,w[A][0],(function(e){o(e,A)}))),m.push(i(e,"dragstart",n)),d.mouse&&!A&&m.push(i(e,w[3][0],(function(e){o(e,3)}))),m.push(i(e,"click",(function(e){E&&d.click(e)}))),{getClicksAllowed:function(){return E},kill:function(){for(var e=m.length-1;e>=0;e--)m[e].remove()}}}i.d(t,{default:function(){return o}}),window.jQuery&&((n=window.jQuery).fn.Peppermint=function(e){return this.each((function(){n(this).data("Peppermint",a(this,e))})),this}),window.Peppermint=a,window.EventBurrito=s;var o=a},84959:function(e,t,i){"use strict";var a=i(62641),n=i(64485),s=i(52822),o=i(62474),r=i(95728),l=i(36461);function u(e){var t=["ai_controls"];e.position&&t.push("ai_has_position");var i=e.can_del?"true":"false",n="return window.audioplayer.morePopup(event, '"+e.audio_id+"', '"+e.access_key+"', "+i+");",s=e.is_authenticated?"audioplayer.setPosition(this, event);":null,o=e.is_authenticated?"audioplayer.sliderMove(event);":null,r=e.is_authenticated?"audioplayer.sliderUp(event);":null,u="aic_line";e.is_authenticated||(u+=" aic_line_blocked");var c=["ai_chart_info_state"],h="";switch(e.chart_info_state){case"new_release":c.push("ai_chart_info_state-new_release"),h=(0,l.Icon16New)();break;case"no_changes":c.push("ai_chart_info_state-no_changes"),h=(0,l.Icon16Minus)();break;case"moved_up":c.push("ai_chart_info_state-moved_up"),h=(0,l.Icon16Up)();break;case"moved_down":c.push("ai_chart_info_state-moved_down"),h=(0,l.Icon16Down)();break;case"crown":c.push("ai_chart_info_state-crown"),h=(0,l.Icon16Crown)();break;default:h=""}return(e.chart_info_position||h)&&t.push("ai_controls_chart"),{inner:[{inner:[d(e),e.has_actions_menu?{inner:[{class:"i_pointer",tag:"i"},{class:"ai_menu_toggle_button",onClick:n,"aria-label":(0,a.getLang)("mobile_more"),tag:"button"}],class:"ai_menu_wrap",tag:"div"}:null,{inner:[e.chart_info_position||h?{inner:[e.chart_info_position?{inner:[e.chart_info_position],class:"ai_chart_info_position",tag:"div"}:null,h?{inner:[h],class:c,tag:"div"}:null],class:"ai_chart_info",tag:"div"}:null,e.duration?{inner:[e._duration_title],class:"ai_dur","data-dur":e.duration,onClick:"audioplayer.switchTimeFormat(this, event);",tag:"time"}:null,{inner:[{inner:[Wd.wrap(e.title),e.subtitle?{inner:[Wd.wrap(e.subtitle)],class:"ai_subtitle",tag:"span"}:null],class:"ai_title",tag:"span"},e.title?{inner:[Wd.wrap(" &ndash; ")],class:"divider",tag:"span"}:null,{inner:[Wd.wrap(e.artist)],class:"ai_artist",tag:"span"}],class:"ai_label",tag:"div"},{type:"hidden",value:e.url,tag:"input"}],class:"ai_body",tag:"div"}],class:"ai_info",tag:"div"},{inner:[{inner:[{inner:[{inner:[{inner:[{class:"aic_ln aic_back_line",onClick:"cancelEvent(event);",tag:"div"},{class:"aic_ln aic_load_line",onClick:"cancelEvent(event);",tag:"div"},{inner:[{inner:[{class:"aic_slider",onClick:"cancelEvent(event);",tag:"div"}],class:"aic_ln aic_progress_line",onClick:"cancelEvent(event);",tag:"div"}],class:"aic_ln aic_pl_wrap",onClick:"cancelEvent(event);",tag:"div"}],class:u,onTouchStart:e.is_mobile?s:null,onMouseDown:e.is_mobile?null:s,onTouchMove:e.is_mobile?o:null,onTouchEnd:e.is_mobile?r:null,onTouchCancel:e.is_mobile?r:null,onMouseMove:e.is_mobile?null:o,onMouseUp:e.is_mobile?null:r,onClick:"cancelEvent(event);",tag:"div"}],class:"aic_progress_wrap",tag:"td"},{inner:[{inner:[{class:"aic_ln aic_back_line",onClick:"cancelEvent(event);",tag:"div"},{inner:[{inner:[{class:"aic_slider",onClick:"cancelEvent(event);",tag:"div"}],class:"aic_ln aic_progress_line",onClick:"cancelEvent(event);",tag:"div"}],class:"aic_ln aic_pl_wrap",onClick:"cancelEvent(event);",tag:"div"}],class:"aic_line",onTouchStart:e.is_mobile?"audioplayer.setVolume(this, event);":null,onMouseDown:e.is_mobile?null:"audioplayer.setVolume(this, event);",onTouchMove:e.is_mobile?"audioplayer.sliderMove(event);":null,onTouchEnd:e.is_mobile?"audioplayer.sliderUp(this, event);":null,onTouchCancel:e.is_mobile?"audioplayer.sliderUp(this, event);":null,onMouseMove:e.is_mobile?null:"audioplayer.sliderMove(event);",onMouseUp:e.is_mobile?null:"audioplayer.sliderUp(event);",onClick:"cancelEvent(event);",tag:"div"}],class:"aic_volume_wrap",tag:"td"}],tag:"tr"}],class:"row_table",tag:"table"}],class:t,tag:"div"}],tag:"div"}}function d(e){var t=e.is_playlist_forced?", true":"",i="audioplayer.playPause(event, '"+e.audio_id+"'"+t+");",n="",u=e.has_cover?(0,s.default)((0,o.getPlayOnCover24Icon)()):(0,l.Icon24Play)(),d=e.has_cover?(0,s.default)((0,r.getPauseOnCover24Icon)()):(0,l.Icon24Pause)();return e.has_cover&&!e.cover_style&&(n={inner:[(0,l.Icon28SongOutline)()],class:"ai_cover_placeholder",tag:"span"}),{inner:[n,{inner:[u],class:"i_play","aria-label":(0,a.getLang)("mobile_audio_player_play")+" "+(0,a.getLang)("mobile_audio_single_title"),tag:"span"},{inner:[d],class:"i_pause","aria-label":(0,a.getLang)("mobile_audio_player_pause")+" "+(0,a.getLang)("mobile_audio_single_title"),tag:"span"}],class:"ai_play",style:e.cover_style,onClick:i,tag:"button"}}t.default=function(e){var t=e.is_playlist_forced?", true":"",i=e.is_disabled?"":"audioplayer.playPause(event, '"+e.audio_id+"'"+t+")",s=e.classes||[],o={};o[e.audio_id]=!0;var r=[n.default.class("audio_item",o,"_"),e.is_no_progress&&"ai_noProgress",e.is_focus&&"ai_focus",e.is_explicit&&"audio_item_explicit",e.is_disabled&&"audio_item_disabled",(e.can_add||e.can_del)&&"ai_has_btn",!e.has_actions_menu&&"ai_no_menu",e.has_cover&&"ai_has_cover"];e.is_attachment&&r.push("ai_select");var l=(0,a.mergeArrays)(r,s).filter((e=>e)).join(" ");return e.is_attachment?{inner:[u(e)],"data-id":e.audio_id,class:l,"data-audio":e.serialized,href:e.attachment_action,tag:"a"}:{inner:[u(e)],"data-id":e.audio_id,"data-playlist-id":e.playlist_id,class:l,onClick:i,"data-audio":e.serialized,tag:"div"}}},38574:function(e,t,i){"use strict";function a(e){for(var t=Array.from(e),i=[],a=0,n=null,s=0;s<t.length;s+=1){var o=t[s],{offsetWidth:r,offsetLeft:l,offsetHeight:u}=o;n=0===s?l:n,i.push({width:r,height:u,offsetLeft:l,marginLeft:n}),a<r&&(a=r)}for(var d=0;d<i.length;d+=1)i[d].width=a;return i}function n(e,t){Array.from(e).forEach(((e,i)=>{e.style.marginLeft=t[i].marginLeft+"px",e.style.width=t[i].width+"px",e.style.height=t[i].height+"px",e.style.flex="none"}))}function s(e,t,i){return-1*(e[t].offsetLeft+e[t].width/2-i/2)}function o(e,t){var{timeStamp:i,touches:a}=e,{clientX:n,clientY:s}=a?a[0]:e,{x:o=n,y:r=s}=t.to||{},l={x:n-o,y:s-r},u=i-(t.time||0);return{to:{x:n,y:s},offset:l,time:i,speed:{x:l.x/u,y:l.y/u},duration:u}}i.d(t,{LoopSlider:function(){return p}});var r,l,u=i(20848),d="idle",c="moving",h="resort",_="recalculating";class p{constructor(e,t){this.container=null,this.scrollEl=null,this.items=null,this.centralElementIndex=0,this.dimensions=[],this.currentIndex=0,this.isTouchActive=!1,this.startOffset=null,this.startInfo=null,this.currentInfo=null,this.state=null,this.container=e,this.scrollEl=t,this.items=this.scrollEl.childNodes,this.handleTouchStart=this.handleTouchStart.bind(this),this.handleTouchMove=this.handleTouchMove.bind(this),this.handleTouchEnd=this.handleTouchEnd.bind(this),this.handleTransitionEnd=this.handleTransitionEnd.bind(this),this.resortSlides=this.resortSlides.bind(this),this.handleWindowDimensionsChange=this.handleWindowDimensionsChange.bind(this),this.handleDragstart=this.handleDragstart.bind(this),this.init()}init(){this.items.length<=1||(this.cloneSlides(),this.dimensions=a(this.items),n(this.items,this.dimensions),this.dimensions=a(this.items),this.setCentralSlidePosition(),this.scrollEl.style.width="max-content",this.setupCallbacks(),this.enableAutoscroll(),this.state=d)}setupCallbacks(){(0,u.addEvent)(this.container,"dragstart",this.handleDragstart),(0,u.addEvent)(this.container,"mousedown touchstart",this.handleTouchStart),(0,u.addEvent)(this.container,"mousemove touchmove",this.handleTouchMove,{passive:!1}),(0,u.addEvent)(this.container,"mouseleave mouseup touchend touchcancel dragend",this.handleTouchEnd),(0,u.addEvent)(this.scrollEl,"transitionend",this.handleTransitionEnd),window.addEventListener("orientationchange",this.handleWindowDimensionsChange)}destroy(){this.disableAutoscroll(),cancelAnimationFrame(l),(0,u.removeEvent)(this.container,"dragstart",this.handleDragstart),(0,u.removeEvent)(this.container,"mousedown touchstart click",this.handleTouchStart),(0,u.removeEvent)(this.container,"mousemove touchmove",this.handleTouchMove),(0,u.removeEvent)(this.container,"mouseleave mouseup touchend touchcancel dragend",this.handleTouchEnd),(0,u.removeEvent)(this.scrollEl,"transitionend",this.handleTransitionEnd),window.removeEventListener("orientationchange",this.handleWindowDimensionsChange)}handleDragstart(e){e.target!==this.scrollEl&&(e.preventDefault(),e.stopPropagation())}handleTouchStart(e){this.isTouchActive||(this.initTouchEvent(e),this.disableAutoscroll())}initTouchEvent(e){this.startOffset=this.getScrollPosition(),this.startInfo=o(e,{}),this.currentInfo=this.startInfo}handleTouchMove(e){if(this.startInfo)if(this.currentInfo=o(e,this.startInfo),this.isTouchActive){e.cancelable&&e.preventDefault();var t=this.startOffset+this.currentInfo.offset.x;this.setScrollPosition(t)}else this.shouldMove(this.currentInfo)&&(this.isTouchActive=!0,this.initTouchEvent(e))}shouldMove(e){if(this.state===c||this.state===h||this.state===_)return!1;var{offset:t}=e;return 180*Math.atan(Math.abs(t.y)/Math.abs(t.x))/Math.PI<30}handleTouchEnd(e){if(this.startInfo=null,!this.isTouchActive||function(e){if(!e)return!1;var{offset:t,duration:i}=e;return Math.abs(t.x)<1&&Math.abs(t.y)<1&&i<200}(this.currentInfo))return t=e.target,void((i=t.closest("a"))&&i.href&&(window.location=i.href));var t,i;e.preventDefault(),e.stopPropagation(),this.go(this.currentInfo),this.enableAutoscroll(),this.isTouchActive=!1}cloneSlides(){var e=this.items;this.centralElementIndex=e.length;for(var t=document.createDocumentFragment(),i=document.createDocumentFragment(),a=0;a<e.length;a+=1)t.appendChild(e[a].cloneNode(!0)),e.length<4&&i.appendChild(e[a].cloneNode(!0));this.scrollEl.insertBefore(t,this.scrollEl.firstChild),this.scrollEl.appendChild(i)}go(e){var t=e.speed.x,i=Math.abs(t);if(0!==i){var a=t<0?-1:1,n=this.getScrollPosition();i>.6&&Math.abs(e.offset.x)<150&&(n+=a*Math.min(600*i,this.getContainerWidth()));var s=function(e,t,i){for(var a=null,n=null,s=i/2-e,o=0;o<t.length;o+=1){var r=t[o].offsetLeft+t[o].width/2,l=Math.abs(r-s);(null===a||l<a)&&(a=l,n=o)}return n}(n,this.dimensions,this.getContainerWidth());s===this.currentIndex&&i>.1&&(s=this.currentIndex-a),s-this.currentIndex>1&&(s=this.currentIndex+1),s-this.currentIndex<-1&&(s=this.currentIndex-1),this.scrollToSlide(s)}}resortSlides(){var{centralElementIndex:e,scrollEl:t,currentIndex:i}=this;if(e!==i){var a=document.createDocumentFragment();if(i>e){for(var n=i-e;n>0;)a.appendChild(t.childNodes[0]),n-=1;t.appendChild(a)}if(i<e){for(var s=e-i,o=t.childNodes.length-s;s>0;)a.appendChild(t.childNodes[o]),s-=1;t.insertBefore(a,t.firstChild)}this.setCentralSlidePosition()}}setScrollPosition(e){this.scrollEl.style.transform="translateX("+e+"px)"}getScrollPosition(){return parseFloat(this.scrollEl.style.transform.replace("translateX(",""))}getContainerWidth(){return this.container.offsetWidth}setCentralSlidePosition(){var e=s(this.dimensions,this.centralElementIndex,this.getContainerWidth());this.currentIndex=this.centralElementIndex,this.setScrollPosition(e)}scrollToSlide(e){this.state=c,this.scrollEl.style.transition="transform 200ms cubic-bezier(.42,.65,.27,.99)";var t=s(this.dimensions,e,this.getContainerWidth());this.setScrollPosition(t),this.currentIndex=e}handleTransitionEnd(){this.scrollEl.style.transition=null,this.state=h,l=window.requestAnimationFrame((()=>{this.resortSlides(),this.state=d}))}scrollToNext(){var e=(this.currentIndex+1)%this.items.length;this.scrollToSlide(e)}enableAutoscroll(){r&&clearInterval(r),r=setInterval((()=>{this.scrollToNext()}),4e3)}disableAutoscroll(){r&&(clearInterval(r),r=null)}handleWindowDimensionsChange(){var e;this.state=_,e=this.items,Array.from(e).forEach((e=>{e.style.marginLeft="",e.style.width="",e.style.height="",e.style.flex=""})),this.scrollEl.style.width="",window.requestAnimationFrame((()=>{setTimeout((()=>{this.dimensions=a(this.items),n(this.items,this.dimensions),this.dimensions=a(this.items),this.setCentralSlidePosition(),this.state=d}))}))}}},85677:function(e,t,i){"use strict";i.d(t,{UnauthorizedActionModal:function(){return d}});var a=i(62641),n=i(85703),s=i(81294),o=i(52822),r=i(36461),l=i(40684),u=i(4726);function d(e){void 0===e&&(e={});var t,i=e.loginUrl||"/login",d=e.joinUrl||"/join",c=e.showOpenInApp,h=e.openInAppUrl,_={more:{title:(0,a.getLang)("mobile_unauthorized_action_more_title"),description:(0,a.getLang)("mobile_unauthorized_action_more_description")},like:{title:(0,a.getLang)("mobile_unauthorized_action_like_title"),description:(0,a.getLang)("mobile_unauthorized_action_like_description")},share:{title:(0,a.getLang)("mobile_unauthorized_action_share_title"),description:(0,a.getLang)("mobile_unauthorized_action_share_description")}};t=e.title||e.description?{title:e.title,description:e.description}:_[e.type];var p,f=e.iconType,v=e.iconUrl;if(f||(f="like"===e.type?"like":"share"===e.type?"share":"vk"),v)p=(0,u.Avatar)({size:72,src:v,borderRadius:"full"});else switch(f){case"vk":p=(0,r.Icon56LogoVk)();break;case"like":p=(0,r.Icon56LikeOutline)();break;case"share":p=(0,r.Icon56ShareOutline)();break;case"photo":p=(0,r.Icon56GalleryOutline)();break;case"video":p=(0,r.Icon56VideoOutline)();break;case"music":p=(0,r.Icon56MusicOutline)();break;case"add_user":p=(0,r.Icon56UserAddOutline)();break;case"community":p=(0,o.default)({icon:(0,l.getUsers3Outline56Icon)()});break;case"message":p=(0,r.Icon56MessageOutline)()}var g="modal_"+e.type||0;e.isCTA&&(g="cta");var y,m=e.isUnauthorizedFeed,E=null,A=null;if(e.onLoginClick?E=e.onLoginClick:m&&(E="UnauthorizedFeed.onActionClick(event)"),e.onJoinClick?A=e.onJoinClick:m&&(E="UnauthorizedFeed.onActionClick(event)"),c){var w=""+(0,a.getLang)("unauthorized_box_sign_in_or_sign_up");w=(0,a.langTag)('<a class="UnauthorizedActionModal__signInTextLink" href="'+i+'">',"</a>",w,"link_sign_in"),w=(0,a.langTag)('<a class="UnauthorizedActionModal__signUpTextLink" href="'+d+'">',"</a>",w,"link_sign_up"),y={inner:[(0,s.default)({inner:[(0,a.getLang)("mobile_open_in_native_app_float_btn")],class:"UnauthorizedActionModal__openInAppButton",url:h,use_native_onclick:!0,stretch:!0,theme:"regular",size:"large"}),{inner:[Wd.wrap(w)],class:"UnauthorizedActionModal__openInAppFooterText",tag:"div"}],class:"UnauthorizedActionModal__openInAppFooter",tag:"div"}}else y=(0,n.BtnStack)({inner:[(0,s.default)({inner:[(0,a.getLang)("mobile_unauthorized_login")],url:i,onClick:E,attrs:{"data-type":"login","data-from":""+g},use_native_onclick:!0,stretch:!0,theme:"regular",size:"large"}),(0,s.default)({inner:[(0,a.getLang)("mobile_unauthorized_join")],url:d,onClick:A,attrs:{"data-type":"join","data-from":""+g},use_native_onclick:!0,stretch:!0,theme:"positive",size:"large"})],mode:"vertical"});return{inner:[{inner:[{inner:[p],class:"UnauthorizedActionModal__icon",tag:"div"},{inner:[t.title],class:"UnauthorizedActionModal__title",tag:"div"},{inner:[t.description],class:"UnauthorizedActionModal__description",tag:"div"},y],class:"UnauthorizedActionModal__in",tag:"div"}],class:(0,a.classNames)("UnauthorizedActionModal","UnauthorizedActionModal--"+e.type,e.className),tag:"div"}}},134:function(e,t,i){"use strict";i.d(t,{events:function(){return a}});var a={CURRENT_CHANGED:"curr",PLAY:"start",PLAY_REQUESTED:"request_play",PAUSE:"pause",STOP:"stop",UPDATE:"update",LOADED:"loaded",ENDED:"ended",FAILED:"failed",BUFFERED:"buffered",PROGRESS:"progress",VOLUME:"volume",PLAYLIST_CHANGED:"plchange",ADDED:"added",REMOVED:"removed",FREQ_UPDATE:"freq",SEEK:"seek",PLAY_NEXT:"play_next",AD_READY:"ad_ready",AD_DEINITED:"ad_deinit",AD_STARTED:"ad_started",AD_COMPLETED:"ad_completed",START_LOADING:"start_load",CAN_PLAY:"actual_start",SELECT:"select",DESELECT:"deselect",EMPTY_PLAYLIST:"empty_playlist",NOT_FOUND_PLAYLIST:"not_found_playlist",INIT:"init",REQUEST_EXPANDED:"request_expanded",MUSIC_AUDIOS_ADD:"music_audios_add",MUSIC_AUDIOS_DELETE:"music_audios_delete",MUSIC_PLAYLISTS_ADD:"music_playlists_add",MUSIC_OWNERS_FOLLOW:"music_owners_follow",MUSIC_OWNERS_UNFOLLOW:"music_owners_unfollow",CURATOR_FOLLOW:"curator_follow",CURATOR_UNFOLLOW:"curator_unfollow",PLACEHOLDER_REMOVE:"placeholder_remove"}},20587:function(e,t,i){"use strict";i.d(t,{AUDIO_PLAYER_ENUMS:function(){return a}});var a={AUDIO_ITEM_INDEX_ID:0,AUDIO_ITEM_INDEX_OWNER_ID:1,AUDIO_ITEM_INDEX_URL:2,AUDIO_ITEM_INDEX_TITLE:3,AUDIO_ITEM_INDEX_PERFORMER:4,AUDIO_ITEM_INDEX_DURATION:5,AUDIO_ITEM_INDEX_ALBUM_ID:6,AUDIO_ITEM_INDEX_AUTHOR_LINK:8,AUDIO_ITEM_INDEX_LYRICS:9,AUDIO_ITEM_INDEX_FLAGS:10,AUDIO_ITEM_INDEX_CONTEXT:11,AUDIO_ITEM_INDEX_EXTRA:12,AUDIO_ITEM_INDEX_HASHES:13,AUDIO_ITEM_INDEX_COVER_URL:14,AUDIO_ITEM_INDEX_ADS:15,AUDIO_ITEM_INDEX_SUBTITLE:16,AUDIO_ITEM_INDEX_MAIN_ARTISTS:17,AUDIO_ITEM_INDEX_FEAT_ARTISTS:18,AUDIO_ITEM_INDEX_ALBUM:19,AUDIO_ITEM_INDEX_TRACK_CODE:20,AUDIO_ITEM_INDEX_RESTRICTION:21,AUDIO_ITEM_INDEX_ALBUM_PART:22,AUDIO_ITEM_ACCESS_KEY:24,AUDIO_ITEM_CHART_INFO_INDEX:25,AUDIO_ITEM_INDEX_TRACK_PAGE_ID:26,AUDIO_ITEM_HAS_LYRICS_BIT:1,AUDIO_ITEM_CAN_ADD_BIT:2,AUDIO_ITEM_CLAIMED_BIT:4,AUDIO_ITEM_QUEUE_BIT:8,AUDIO_ITEM_HQ_BIT:16,AUDIO_ITEM_LONG_PERFORMER_BIT:32,AUDIO_ITEM_UMA_BIT:128,AUDIO_ITEM_REPLACEABLE:512,AUDIO_ITEM_EXPLICIT_BIT:1024,AUDIO_ENOUGH_LOCAL_SEARCH_RESULTS:500,AUDIO_RECOMS_TYPE_LISTENED:"recoms6",AUDIO_PLAYING_CLS:"audio_row__playing",AUDIO_CURRENT_CLS:"audio_row__current",AUDIO_DURATION_CLS:"audio_row__duration",AUDIO_LAYER_HEIGHT:550,AUDIO_LAYER_MIN_WIDTH:400,AUDIO_LAYER_MAX_WIDTH:1e3,AUDIO_HQ_LABEL_CLS:"audio_hq_label_show",AUDIO_MAX_AUDIOS_IN_SNIPPET:5,AUDIO_ROW_COVER_SIZE:40,AUDIO_ROW_PLAY_SIZE:24,AUDIO_ROW_ACTION_ROW_ITEM:'<button class="audio_row__more_action audio_row__more_action_%0% _audio_row__more_action_%0% %3%">%2%</button>',LOG_LS_KEY:"audiolog",ONBOARDING_ARTISTS_LS_KEY:"artists_onboarding"}},76980:function(e,t,i){"use strict";i.d(t,{asObject:function(){return r}});var a=i(20587),n=i(12733);function s(e,t){var i="";return e.forEach((function(a,n){var s="/audio?performer=1&q="+encodeURIComponent(a.name),o=window.getWebHost?window.getWebHost():"";a.id&&(s="/artist/"+a.id),i+=t?'<a class="artist_link" href="'+o+s+'">'+a.name+"</a>":a.name,n<e.length-1&&(i+=", ")})),i}var o=i(40906);function r(e){if(!e)return null;if((0,o.isObject)(e))return e;if("string"==typeof e)return{id:e};var t=(e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_HASHES]||"").split("/"),i=(e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_COVER_URL]||"").split(","),r=function(e,t){void 0===t&&(t=!0);var i="",o=!(0,n.isPodcast)(e)&&t;if(Array.isArray(e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_MAIN_ARTISTS])&&(i=s(e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_MAIN_ARTISTS],o)),Array.isArray(e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FEAT_ARTISTS])&&(i+=" feat. ",i+=s(e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FEAT_ARTISTS],o)),!i){var r=e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_PERFORMER]?e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_PERFORMER].replace(/<\/?em>/g,""):"";i=o?'<a class="artist_link" data-performer="'+r+'" href="/audio?performer=1&q='+encodeURIComponent(r)+'">'+r+"</a>":r}return i}(e,!1);return{id:(0,o.intval)(e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ID]),owner_id:(0,o.intval)(e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_OWNER_ID]),ownerId:e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_OWNER_ID],fullId:e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ID],title:e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_TITLE]||"",subTitle:e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_SUBTITLE],performer:r,mainArtists:e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_MAIN_ARTISTS],featArtists:e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FEAT_ARTISTS],authorLink:e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_AUTHOR_LINK],duration:(0,o.intval)(e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_DURATION]),lyrics:e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_LYRICS]||"",url:e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_URL],flags:e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FLAGS],context:e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_CONTEXT],extra:e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_EXTRA],accessKey:e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_ACCESS_KEY],addHash:t[0]||"",editHash:t[1]||"",actionHash:t[2]||"",deleteHash:t[3]||"",replaceHash:t[4]||"",urlHash:t[5]||"",restoreHash:t[6]||"",canEdit:!!t[1],canDelete:!!t[3],isLongPerformer:e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FLAGS]&a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_LONG_PERFORMER_BIT,canAdd:!!(e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FLAGS]&a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_CAN_ADD_BIT),coverUrl_s:i[0],coverUrl_p:i[1],hasTrackPage:!!e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_TRACK_PAGE_ID],trackPageId:e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_TRACK_PAGE_ID],isClaimed:!!(e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FLAGS]&a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_CLAIMED_BIT),isFromQueue:!!(e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FLAGS]&a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_QUEUE_BIT),isExplicit:!!(e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FLAGS]&a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_EXPLICIT_BIT),isUMA:!!(e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FLAGS]&a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_UMA_BIT),isReplaceable:!!(e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FLAGS]&a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_REPLACEABLE),ads:e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ADS],album:e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ALBUM],albumId:(0,o.intval)(e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ALBUM_ID]),albumPart:(0,o.intval)(e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ALBUM_PART]),trackCode:e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_TRACK_CODE],restrictionStatus:e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_RESTRICTION],chartInfo:e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_CHART_INFO_INDEX]}}},12733:function(e,t,i){"use strict";i.d(t,{isPodcast:function(){return s}});var a=i(20587),n=i(40906);function s(e){if(!e)return!1;var t=(0,n.isObject)(e)?e.extra:e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_EXTRA];return(0,n.isObject)(t)||(t=JSON.parse(t||"{}")),!!t.podcast}},22899:function(e,t,i){"use strict";i.d(t,{Resampler:function(){return n},fastResample:function(){return s}});var a={avg:class{constructor(){this.clear()}push(e){this._count++,this._accum+=e}get(){return this._accum/this._count}clear(){this._count=0,this._accum=0}},peak:class{constructor(){this.clear()}push(e){this._max=Math.max(this._max,Math.abs(e))}get(){return this._max}clear(){this._max=0}},quad:class{constructor(){this.clear()}push(e){this._count++,this._accum+=e,this._accum_q+=e*e}get(){return 1==this._count?this._accum:Math.sqrt((this._accum_q-this._accum*this._accum/this._count)/this._count)}clear(){this._count=0,this._accum=0,this._accum_q=0}}};class n{constructor(e){this._normalizeAlgorithm=!1,a[e.normalizeAlgorithm]&&(this._normalizeAlgorithm=new a[e.normalizeAlgorithm]),this._srcSampleRate=parseInt(e.srcSampleRate||0),this._dstSampleRate=parseInt(e.dstSampleRate||0),this._truncateTo=1,void 0!==e.truncateTo&&(this._truncateTo=e.truncateTo),this._dstSampleRate>0?this._sampleRate=this._srcSampleRate/this._dstSampleRate:this._sampleRate=0,a[e.algorithm]||(e.algorithm="peak"),this._algorithm=new a[e.algorithm],this._sampleCount=0,this._data=[]}push(e){if(this._sampleRate<=0)return[];for(var t,i=[],a=0;a<e.length;a++)if(this._truncateTo>0&&(e[a]=Math.min(this._truncateTo,Math.abs(e[a]))),this._sampleCount+=1,this._sampleCount>=this._sampleRate)for(;this._sampleCount>=this._sampleRate;)this._sampleCount-=this._sampleRate,this._sampleCount<=.8&&this._algorithm.push(e[a]),t=this._algorithm.get(),i.push(t),this._normalizeAlgorithm&&this._normalizeAlgorithm.push(t),this._algorithm.clear(),this._sampleCount>.2&&this._algorithm.push(e[a]);else this._algorithm.push(e[a]);if(this._normalizeAlgorithm){var n=this._normalizeAlgorithm.get();if(this._normalizeAlgorithm.clear(),n>0)for(var s=0;s<i.length;s++)i[s]=i[s]/n,this._truncateTo>0&&(i[s]=Math.min(this._truncateTo,Math.abs(i[s])))}return i}}function s(e,t,i){return void 0===i&&(i="peak"),new n({srcSampleRate:e.length,dstSampleRate:t,normalizeAlgorithm:i,truncateTo:0}).push(e)}},62936:function(e,t,i){"use strict";var a;i.d(t,{CatalogEvent:function(){return a}}),function(e){e.MusicOwnersFollow="music_owners_follow",e.MusicOwnersUnfollow="music_owners_unfollow",e.CuratorFollow="curator_follow",e.CuratorUnfollow="curator_unfollow",e.ArtistFollow="artist_follow",e.ArtistUnfollow="artist_unfollow",e.PlaceholderRemove="placeholder_remove"}(a||(a={}))},26289:function(e,t,i){"use strict";i.d(t,{Section:function(){return d}});var a=i(12334),n=function(){function e(){}return e.processBanner=function(e){var t=e.querySelector(".MusicAuthorCover__title");t instanceof HTMLElement&&((0,a.truncateMultilineText)(t,1),parseInt(getComputedStyle(t).lineHeight)===t.clientHeight&&t.classList.add("MusicAuthorCover__title--singleLine"),t.scrollHeight>t.clientHeight&&t.classList.remove("MusicAuthorCover__title--singleLine"),t.classList.remove("MusicAuthorCover__title--hidden"))},e}(),s=i(20848),o=i(79764),r=i(62936),l=i(76980),u="",d=function(){function e(){}return e.onShow=function(){var t=document.querySelector("."+e.BASE_SELECTOR);if(t){var i=t.querySelector(".AudioBlock_artist.AudioBlock_banner");i instanceof HTMLElement&&n.processBanner(i);var a=t.querySelector(".AudioBlock_curator.AudioBlock_banner");a instanceof HTMLElement&&n.processBanner(a)}},e.getContainerElement=function(){return document.querySelector("."+e.CONTAINER)},e.getSection=function(t){return document.querySelector("."+e.BASE_SELECTOR+"__"+t)},e.getAllSections=function(){return Array.from(document.querySelectorAll("."+e.BASE_SELECTOR))},e.setSectionContent=function(e,t){var i=document.querySelector("."+e);i&&(i.innerHTML=t)},e.onSearchLoaded=function(t,i,a,n,s){u===n&&e.toggleSearch(n,s)},e.onSearchFiltered=function(t,i){u=t,e.toggleSearch(t,i)},e.toggleSearch=function(t,i){e.getAllSections().forEach((function(e){var a=i===e?!!t:!t,n=e.querySelector(".show_more");n instanceof HTMLElement&&(a?delete n.dataset.disabled:n.dataset.disabled="1"),(0,s.toggle)(e,a)}))},e.handlePagination=function(t,i){var a=e.getSection(i.name),n=window.cdf(t);if(a&&n){var s=void 0,o=a.querySelectorAll(".AudioBlock"),r=o[o.length-1];(s=r instanceof HTMLElement&&r.dataset.viewType&&["list","music_chart_list"].includes(r.dataset.viewType)?r.querySelector(".AudioBlock__content"):a)&&s.append(n),i.playlist&&window.audio.getCurrentPlaylistId()===i.playlist.id&&window.audio.addToPlaylist(i.playlist.list.map((function(e){return(0,l.asObject)(e)})))}},e.hideBlock=function(e,t){o.default.post("/audio?act=catalog_hide_block",{block_id:e});var i=t.closest(".AudioBlock");i instanceof HTMLElement&&window.audioplayer.emitCatalogEvent(r.CatalogEvent.PlaceholderRemove,i.dataset.blockId)},e.BASE_SELECTOR="AudioSection",e.CONTAINER="AudioSerp",e}()},5309:function(e,t,i){"use strict";var a=i(75105),n=i(62936),s=i(81294);var o=i(39871),r=i(9223),l=i(62641),u=null;var d=i(79764),c=null,h=function(){function e(){}return e.follow=function(e,t,i){i&&(0,s.setLoading)(i,!0),d.default.post("audio.php",{_ajax:1,act:"follow_owner",hash:t,owner_id:e},{onDone:function(){i&&(0,s.setLoading)(i,!1),window.audioplayer.emitCatalogEvent(n.CatalogEvent.MusicOwnersFollow)},onFail:function(){return i&&(0,s.setLoading)(i,!1),!0}})},e.openUnfollowActionsheet=function(e,t,i){c=i;var a=o.default.elem((0,r.default)({items:[(0,r.ModalMenuBtn)({inner:(0,l.getLang)("audio_unfollow_owner_button"),onclick:["MusicOwner.unfollow",e,""+t]})],close:!0}));(0,r.open)(a)},e.unfollow=function(e,t,i){(0,r.close)(),!i&&c&&(i=c),i&&(0,s.setLoading)(i,!0),d.default.post("audio.php",{_ajax:1,act:"unfollow_owner",hash:t,owner_id:e},{onDone:function(){i&&(0,s.setLoading)(i,!1),window.audioplayer.emitCatalogEvent(n.CatalogEvent.MusicOwnersUnfollow)},onFail:function(){return i&&(0,s.setLoading)(i,!1),!0}})},e}(),_=i(40906),p=i(70313),f=i(26271),v=i(134),g=i(12733),y=i(79957);class m{constructor(e,t,i){this._isPlaying=!1,this._adsCurrentProgress=0,this._adman=null,this._admanLoaded=!1,this._adEvents=[],this.player=e||{},this.playerVersion=t||null,this._startAdsTO=null,this._adsConfig=null,this._duration=0,this.isMvk=Boolean(i),this.adsStatUrl=this.isMvk?"audio":"al_audio.php"}isPlaying(){return this._isPlaying}setAdsConfig(e){this._adsConfig=e}getCurrentProgress(){return this._adsCurrentProgress}getDuration(){return this._duration}loadAdman(e){var t=t=>e&&e(t);if(this._admanLoaded)t();else{var i=0;(0,p.loadScript)(m.ADMAN_SRC,{onLoad:()=>{this._admanLoaded=!0,t()},onError:()=>{window.abp?(this._admanLoaded=!0,t()):(3===(i+=1)&&(this._admanLoaded=!0),t("script_load_fail"))}})}}_fetchAd(e,t,i,a,n){this.loadAdman((s=>{if(!window.AdmanHTML)return this._sendEvent("no_adman",t,m.AD_TYPE,s),a&&a();this._adman=new AdmanHTML;var o=this._adsConfig||vk.audioAdsConfig||window.audioAdsConfig,r={_SITEID:276,ver:251116,vk_id:vk.id,duration:e.duration,content_id:E(e.ownerId,e.id),vk_catid:m.CAT_IDS[t]||m.CAT_IDS.other,sign:o.sign||""};Object.assign(r,e.ads||{}),nav.objLoc&&nav.objLoc.preview&&(r.preview=(0,_.intval)(nav.objLoc.preview)),cur.adsPreview&&(r.preview=1,r.vk_id=398724832),this._adman.setDebug(!!r.preview),this._adman.onError((()=>a&&a())),this._adman.onReady((()=>{if(this._adman){var e=this._adman.getBannersForSection(m.AD_TYPE);e&&e.length?"statistics"===e[0].type?(this._play(!0,t),a&&a()):(this._sendEvent("received",t),i?(this._sendEvent("rejected",t,m.AD_TYPE,n),this.deinit(),a&&a()):(this._sendEvent("ready",t),this.player.notify(v.events.AD_READY),this._play(!1,t,a))):(i||this._sendEvent("not_received",t),a&&a())}})),this._adman.init({slot:3514,wrapper:document.createElement("div"),params:r,browser:{adBlock:!!window.abp,mobile:!1}}),this._sendEvent("requested",t)}))}_sendEvent(e,t,i,a){var n=i?"/"+i:"",s=a?"/"+a:"";this._adEvents.push(e+"/"+t+n+s),clearTimeout(this._adEventDelay),this._adEventDelay=setTimeout((()=>{ajax.post(this.adsStatUrl,{act:"ad_event",events:this._adEvents.join(","),v:this.playerVersion,abp:(0,_.intval)(window.abp)},{onFail:()=>!0}),this._adEvents=[]}),500)}_play(e,t,i){this._adman.onCompleted((()=>{this.deinit(!0),e?this._sendEvent("statistics",t):(this.player.notify(v.events.PROGRESS,0),this.player.notify(v.events.AD_COMPLETED),this._isPlaying=!1,this._adsCurrentProgress=0,this._sendEvent("completed",t),window.setDocumentTitle&&window.setDocumentTitle(this._adsPrevTitle),i&&i())})),this._adman.onStarted((()=>{e||(this.player.setIsPlaying(!0),this.player.notify(v.events.PLAY),this.player.notify(v.events.PROGRESS,0),this.player.notify(v.events.AD_STARTED),this.updateVolume(),this._sendEvent("started",t),window.statlogsValueEvent&&(0,y.statlogsValueEvent)("audio_web_ad_link","show"))})),this._adman.onPaused((()=>{this.player.setIsPlaying(!1),this.player.notify(v.events.PAUSE)})),this._adman.onPlayed((()=>{this.player.setIsPlaying(!0),this.player.notify(v.events.PLAY)}));var a=[.25,.5,.75];if(this._adman.onTimeRemained((e=>{this._duration=isNaN(e.duration)?0:e.duration,this._adsCurrentProgress=(isNaN(e.percent)?0:e.percent)/100,this.player.notify(v.events.PROGRESS,this._adsCurrentProgress,this._duration),(0,_.each)(a,((e,i)=>{if(this._adsCurrentProgress>=i)return a.shift(),this._sendEvent("progress_"+(0,_.intval)(100*i),t),!1}))})),this._adman.start(m.AD_TYPE),e)return i&&i();this._isPlaying=!0,this._adsPrevTitle=document.title,this.isMvk||window.setDocumentTitle(getLang("global_audio_ad"))}updateVolume(){this._adman&&this._adman.setVolume(.7*this.player.getVolume())}deinit(e){this._adman=null,!e&&this.player.notify(v.events.AD_DEINITED)}pause(){this._adman&&(this.player.setIsPlaying(!1),this._adman.pause())}stop(){this._adman&&(this.player.setIsPlaying(!1),this._adman.stop())}resume(){this._adman&&(this.player.setIsPlaying(!0),this._adman.resume(),this.player.notify(v.events.PLAY))}checkPlay(e,t){var i=this.player._getPlayingContextSection(),{type:a,reason:n}=this._isAllowed(e),s=()=>t&&t();switch(a){case m.ALLOW_ALLOWED:this._fetchAd(e,i,!1,s);break;case m.ALLOW_DISABLED:s();break;case m.ALLOW_REJECT:this._fetchAd(e,i,!0,!1,n),s()}}hasAdsSupport(){var e=(0,_.intval)(f.browser.version.split(".")[0]);return!(f.browser.safari&&e<14||f.browser.chrome&&e<50)}_isAllowed(e){if(vk.widget)return{type:m.ALLOW_DISABLED};if((0,g.isPodcast)(e))return{type:m.ALLOW_DISABLED};var t=this._adsConfig||vk.audioAdsConfig||window.audioAdsConfig;if(t){if(!t.enabled||!this.hasAdsSupport())return{type:m.ALLOW_DISABLED};if(cur.adsPreview)return{type:m.ALLOW_ALLOWED};if(t.day_limit_reached)return{type:m.ALLOW_REJECT,reason:m.REJECT_REASON_LIMIT};var i=this.player._getPlayingContextSection();return t.sections.indexOf(i)>-1?{type:m.ALLOW_ALLOWED}:{type:m.ALLOW_REJECT,reason:m.REJECT_REASON_SECTION}}return{type:m.ALLOW_REJECT,reason:m.REJECT_REASON_UNKNOWN}}startPlay(e,t){this.checkPlay(e,t)}}function E(e,t){for(var i=e.toString(16),a=t.toString(16);a.length<8;)a="0"+a;return i+a}m.ADMAN_SRC="//ad.mail.ru/static/admanhtml/rbadman-html5.min.js",m.CAT_IDS={my:101,my_playlists:101,audio_feed:109,recent:113,user_wall:104,group_wall:104,user_list:102,group_list:103,user_playlists:102,group_playlists:103,feed:105,search:110,global_search:110,replies:104,im:106,group_status:104,user_status:104,recs:107,recs_audio:107,recs_album:107,other:114},m.AD_TYPE="preroll",m.ALLOW_DISABLED=1,m.ALLOW_ALLOWED=2,m.ALLOW_REJECT=3,m.REJECT_REASON_UNKNOWN="unknown",m.REJECT_REASON_LIMIT="track_limit_exceeded",m.REJECT_REASON_SECTION="section_not_allowed";var A=i(20848);var w=i(19331),I=i(16800),P=i(77660);class b{static sendStat(e){(0,A.statlogsValueEvent)("audio_onboarding",e)}constructor(){this.initPopup(),this.popup&&(this.connectEvents(),this.initSlider(),b.sendStat("show_screen"))}initPopup(){var e=document.querySelector(".audioRestrictionSplash");e&&(this.popup=I.default.open(e,!0,{forceScrollDisable:!0}))}connectEvents(){this.popup.querySelectorAll(".audioRestrictionSplash__closeIcon").forEach((e=>{e.addEventListener("click",(e=>{(0,A.gpeByClass)("audioRestrictionSplash__firstScreen",e.target)?b.sendStat("skip_1screen"):(0,A.gpeByClass)("audioRestrictionSplash__secondScreen",e.target)&&b.sendStat("skip_2screen"),this.close()}))})),this.popup.querySelector(".audioRestrictionSplash__explain").addEventListener("click",(()=>b.sendStat("click_more"))),this.popup.querySelector(".audioRestrictionSplash__continueFreeLink").addEventListener("click",(()=>{b.sendStat("continue_free"),this.close()})),this.popup.querySelector(".audioRestrictionSplash__continueButton").addEventListener("click",(()=>{this.slider.next(),b.sendStat("next_1screen")})),this.popup.querySelector(".audioRestrictionSplash__specialLink").addEventListener("click",(()=>b.sendStat("get_offer")))}initSlider(){this.screens=this.popup.querySelector(".audioRestrictionSplash__screens"),this.slider=(0,P.default)(this.screens,{dots:!0,speed:500})}close(){I.default.close(this.popup)}}var C=i(49598),T=i(49265);class S{static _supports(e){return e+"Hidden"in document}constructor(){this.visibleCallbacks=[],this.hiddenCallbacks=[],this.visibilityPrefix="",this.hiddenStateName="hidden",this.isHidden=!1,this.listen()}onVisible(e){this.visibleCallbacks.push(e)}onHidden(e){this.hiddenCallbacks.push(e)}listen(){try{var e=T.default.version.split(".")[0];if(T.default.safari_mobile&&e<=7)return window.addEventListener("pagehide",(()=>this._hidden())),void window.addEventListener("pageshow",(()=>this._visible()));!(T.default.android&&T.default.safari&&e<5)&&this.isSupported()?(document.addEventListener(this.visibilityPrefix+"visibilitychange",(()=>this._nativeSwitch(arguments))),window.addEventListener(this.visibilityPrefix+"visibilitychange",(()=>this._nativeSwitch(arguments)))):document.addEventListener?(window.addEventListener("focus",(()=>this._visible()),1),window.addEventListener("blur",(()=>this._hidden()),1)):(document.attachEvent("onfocusin",(()=>this._visible())),document.attachEvent("onfocusout",(()=>this._hidden())))}catch(e){}}isSupported(){for(var e=0;e<S.prefixes.length;e++){var t=S.prefixes[e];if(S._supports(t))return this.hiddenStateName=(t?t+"H":"h")+"idden",this.visibilityPrefix=t,!0}return!1}_visible(){this.isHidden=!1,this.visibleCallbacks.forEach((e=>e()))}_hidden(){this.isHidden=!0,this.hiddenCallbacks.forEach((e=>e()))}_nativeSwitch(){!0===document[this.hiddenStateName]?this._hidden():this._visible()}}function k(e){var t=null;if(e.action_button){var i=e.action_button;t={class:"AudioPopup__actionButtonWrapper",inner:{class:["AudioPopup__actionButton","button"],onclick:i.onclick,href:i.href,inner:i.text}}}var a=["AudioPopup"];e.popupClass&&a.push(e.popupClass);var n={class:"AudioPopup__content",inner:[{class:"AudioPopup__title",inner:e.title},{class:"AudioPopup__description",inner:e.description},t,e.additional_link]};return new C.default({content:n,class:a.join(" ")})}S.prefixes=["webkit","o","ms","moz",""];var L=i(76567);class M{static writePopupStat(e){statlogsValueEvent("mvk_audio_background_popup",e)}static createPopup(){var e={href:M.EXPLANATION_LINK,onclick:'AudioBackgroundRestriction.writePopupStat("explanation_click");',class:"AudioPopup__explanation",inner:getLang("mobile_audio_background_restriction_explanation")};return Wd.elem(k({popupClass:"AudioRestrictionPopup",title:getLang("mobile_audio_background_restriction_title"),description:getLang("mobile_audio_background_restriction_description"),action_button:{href:M.REMOVE_RESTRICTION_LINK,onclick:'AudioBackgroundRestriction.writePopupStat("link_click");',text:getLang("mobile_audio_background_restriction_button")},additional_link:e}))}constructor(){audioSubscribe||(this.isIdle=!1,this.showAlertCountToday=function(e,t){void 0===t&&(t=0);var i=parseInt((0,L.getCookie)(e),10);if(isNaN(i,10))return t;return i}(M.SHOW_ALERT_COOKIE),this.initVisibilityChangeEvent())}onIdle(){window.audio.playing()&&this.triggerRestriction()}showBackgroundMessage(){var e=M.createPopup();this.showAlertCountToday+=1,(0,L.setCookie)("remixaudio_show_alert_today",this.showAlertCountToday,1),this.showAlertCountToday%3||(C.default.open(e,!0),M.writePopupStat("show"))}triggerRestriction(){audio.pause(),this.showBackgroundMessage()}initVisibilityChangeEvent(){this.pageVisibility=new S,this.pageVisibility.onVisible((()=>{this.isIdle=!1})),this.pageVisibility.onHidden((()=>{this.isIdle=!0,this.onIdle()}))}}M.SHOW_ALERT_COOKIE="remixaudio_show_alert_today",M.REMOVE_RESTRICTION_LINK="/offermusic",M.EXPLANATION_LINK="https://vk.cc/9uFgyl";var D=i(12023),O=i(79573),U=function(e){function t(t){return e.call(this,t)||this}return(0,O.__extends)(t,e),t.prototype.connect=function(e){var t=this;e&&this.listenQueueKey!==e.key&&(this.listenQueueKey=e.key,D.QueueManager.addQueue({key:e.key,ts:e.timestamp},(function(e,i){return t.queueHandler(i)})),D.QueueManager.start())},t}((function(e){this.queueHandler=e}));var R=0,N=function(){function e(){this.audioQueueListener=new U(this.handleAudioQueueMessage),this.subscriptionQueueListener=new U(this.handleSubscriptionQueueMessage)}return e.prototype.connect=function(e){var t=this;if(void 0===e&&(e=!1),D.QueueManager.initialized){var i=window.audio.getCurrent(),a=!e&&(this.audioQueueListener.listenQueueKey||this.subscriptionQueueListener.listenQueueKey);i&&!a&&window.ajax.post("/audio",{act:"queue_params",audio_id:i.id,owner_id:i.ownerId,hash:i.actionHash},{onDone:function(e){var i,a,n=(a={},(i=e)&&i.length&&i.filter((function(e){return!!e})).map((function(e){return e.queues&&e.queues[0]})).forEach((function(e){return a[e.type]=e})),a);n.audio&&t.audioQueueListener.connect(n.audio),n.subscription&&t.subscriptionQueueListener.connect(n.subscription),e&&(t.listenQueueRefreshTO&&clearTimeout(t.listenQueueRefreshTO),t.listenQueueRefreshTO=window.setTimeout((function(){return t.connect(!0)}),3e4))},onFail:function(){return R<3&&(R++,setTimeout((function(){return t.connect()}),5e3)),!0}})}},e.prototype.handleAudioQueueMessage=function(t){for(var i=window.audio.playing(),a=0;a<t.events.length;a++){var n=t.events[a].data;if("start"===n.type&&window.audio.getDeviceId()!==n.uuid&&!e.startPlaybackBox&&i){window.audio.pause(),e.showMultipleStreamPopup(n);break}}},e.prototype.handleSubscriptionQueueMessage=function(e){e.events.length&&e.events.forEach((function(e){if(1===e.data.product_id){var t=window.audioAdsConfig||window.vk.audioAdsConfig;t&&(t.enabled=!e.data.active)}}))},e.showMultipleStreamPopup=function(t){var i,a=e.createPopup(t.device_name);(0,C.openPopup)(a,!0,{oncloseCallback:function(){return e.startPlaybackBox=!1}}),null===(i=document.querySelector(".AudioPopup__actionButton"))||void 0===i||i.addEventListener("click",(function(){(0,C.closePopup)()})),e.startPlaybackBox=!0},e.createPopup=function(e){return o.default.elem(k({title:(0,l.getLang)("mobile_audio_start_playback_title"),description:(0,l.getLang)("mobile_audio_start_playback_body").replace("{device_name}",e),action_button:{text:(0,l.getLang)("mobile_audio_continue")}}))},e.startPlaybackBox=!1,e}(),B="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA",x=i(77419),H=i.n(x),F=function(){function e(){this.subscriptions={}}return e.prototype.subscribe=function(e,t){var i=this;return Array.isArray(e)&&e.forEach((function(e){return i.subscribe(e,t)})),this.subscriptions[e]||(this.subscriptions[e]=[]),this.subscriptions[e].push(t),{unsubscribe:function(){return i.unsubscribe(e,t)}}},e.prototype.unsubscribe=function(e,t){if(this.subscriptions[e]){var i=this.subscriptions[e].indexOf(t);i>=0&&this.subscriptions[e].splice(i,1)}},e.prototype.emit=function(e){for(var t=this,i=[],a=1;a<arguments.length;a++)i[a-1]=arguments[a];this.precheck&&!this.precheck.apply(this,(0,O.__spreadArray)([e],(0,O.__read)(i),!1))||(this.onAnyCallBack&&setTimeout((function(){return t.onAnyCallBack.apply(t,(0,O.__spreadArray)([e],(0,O.__read)(i),!1))})),this.subscriptions[e]&&this.subscriptions[e].forEach((function(e){return setTimeout((function(){return e.apply(void 0,(0,O.__spreadArray)([],(0,O.__read)(i),!1))}))})))},e}(),V="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMN0PQRSTUVWXYZO123456789+/=",Y={v:function(e){return e.split("").reverse().join("")},r:function(e,t){var i;e=e.split("");for(var a=V+V,n=e.length;n--;)~(i=a.indexOf(e[n]))&&(e[n]=a.substr(i-t,1));return e.join("")},s:function(e,t){var i=e.length;if(i){var a=function(e,t){var i=e.length,a=[];if(i){var n=i;for(t=Math.abs(t);n--;)t=(i*(n+1)^t+n)%i,a[n]=t}return a}(e,t),n=0;for(e=e.split("");++n<i;)e[n]=e.splice(a[i-1-n],1,e[n])[0];e=e.join("")}return e},i:function(e,t){return Y.s(e,t^vk.id)},x:function(e,t){var i=[];return t=t.charCodeAt(0),(0,_.each)(e.split(""),(function(e,a){i.push(String.fromCharCode(a.charCodeAt(0)^t))})),i.join("")}};function q(e){if((!window.wbopen||!~(window.open+"").indexOf("wbopen"))&&~e.indexOf("audio_api_unavailable")){var t,i,a=e.split("?extra=")[1].split("#"),n=""===a[1]?"":X(a[1]);if(a=X(a[0]),"string"!=typeof n||!a)return e;for(var s=(n=n?n.split(String.fromCharCode(9)):[]).length;s--;){if(t=(i=n[s].split(String.fromCharCode(11))).splice(0,1,a)[0],!Y[t])return e;a=Y[t].apply(null,i)}if(a&&"http"===a.substr(0,4))return a}return e}function X(e){if(!e||e.length%4==1)return!1;for(var t,i,a=0,n=0,s="";i=e.charAt(n++);)~(i=V.indexOf(i))&&(t=a%4?64*t+i:i,a++%4)&&(s+=String.fromCharCode(255&t>>(-2*a&6)));return s}var j=i(76980);var W=i(24530),z=i(60847);function G(e){try{return e.play()||Promise.resolve()}catch(e){return Promise.reject(e)}}var Q,K=i(26330),$=function(){function e(e,t){var i=this;this.fullyLoaded=!1,this.url="",this.audioElement=new Audio,this.audioElement.crossOrigin="anonymous",this.audioElement.preload="auto",this.volume=e.volume,this.addEventListeners(e),t&&this.setUrl(t).then((function(){i.audioElement.load()}));var a=new W.NetworkStatCollector;this.audioNetworkStatCollector=new W.AudioNetworkStatCollector(a)}return Object.defineProperty(e.prototype,"isFullyLoaded",{get:function(){return this.fullyLoaded},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"error",{get:function(){return this.audioElement.error||null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"played",{get:function(){return this.audioElement.played},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"src",{get:function(){return this.url},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hls",{get:function(){return this.hlsInstance||null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return isFinite(this.audioElement.duration)?this.audioElement.duration:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"readyState",{get:function(){return this.audioElement.readyState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentTime",{get:function(){return this.audioElement.currentTime},set:function(e){this.audioElement.currentTime=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this.audioElement.volume},set:function(e){this.audioElement.volume=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playbackRate",{set:function(e){this.audioElement.playbackRate=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentProgress",{get:function(){return isNaN(this.audioElement.duration)?0:Math.max(0,Math.min(1,this.audioElement.currentTime/this.audioElement.duration))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentBuffered",{get:function(){return this.audioElement.buffered.length?Math.min(1,this.audioElement.buffered.end(0)/this.audioElement.duration):0},enumerable:!1,configurable:!0}),e.prototype.play=function(){return G(this.audioElement).catch((function(e){switch(e.code){case e.NOT_SUPPORTED_ERR:case e.ABORT_ERR:break;default:throw e}}))},e.prototype.pause=function(){this.audioElement.pause()},e.prototype.addEventListeners=function(e){var t=this;this.audioElement.addEventListener("pause",(function(){return e.onPause()})),this.audioElement.addEventListener("play",(function(){return e.onPlay()})),this.audioElement.addEventListener("progress",(function(){if(e.onBufferUpdate(),!t.hlsInstance){var i=t.audioElement.buffered;i.length&&Math.abs(i.end(i.length-1)-t.audioElement.duration)<1&&(t.fullyLoaded=!0)}})),this.audioElement.addEventListener("timeupdate",(function(){e.onProgressUpdate&&e.onProgressUpdate()})),this.audioElement.addEventListener("ended",(function(){e.onEnd&&e.onEnd()})),this.onFail=e.onFail||function(){},this.audioElement.addEventListener("error",(function(){t.onFail()})),this.audioElement.addEventListener("canplay",(function(){e.onCanPlay&&e.onCanPlay()})),this.audioElement.addEventListener("durationchange",(function(){e.onDurationChange&&e.onDurationChange()}))},e.isHlsUrl=function(e){return q(e).includes(".m3u8")},e.prototype.setUrl=function(t){var i=this,a=q(t);return this.url=a,e.isHlsUrl(a)&&!e.shouldUseNativeHls()&&"function"==typeof window.MediaSource?this.initHls(a).catch((function(){return i.onFail()})):(this.hlsInstance&&this.hlsInstance.destroy(),this.audioElement.src=a,this.audioElement.load(),Promise.resolve())},e.shouldUseNativeHls=function(){var e=(0,O.__read)(window.browser.version.split("."),1)[0],t=parseInt(e);return window.browser.safari||window.browser.msie_edge&&t>11&&t<78},e.prototype.initHls=function(t){var i=this;return e.loadHls().then((function(e){var a=e.default;return new Promise((function(e){var n=!1,s=!!K.default.get("_audio_hls_debug");i.hlsInstance&&i.hlsInstance.destroy();var o=new a({debug:s,maxBufferHole:3,nudgeOffset:.5,nudgeMaxRetry:5,maxFragLookUpTolerance:.2});o.on(a.Events.BUFFER_EOS,(function(){return i.fullyLoaded=!0})),o.on(a.Events.ERROR,(function(e,t){t.details===a.ErrorDetails.BUFFER_STALLED_ERROR&&(n=!0),(s||t.fatal)&&console.log("audio hls error",e,t),t.details===a.ErrorDetails.BUFFER_STALLED_ERROR&&(o.stopLoad(),o.startLoad()),t.fatal&&i.onFail({type:t.type,details:t.details,url:t.frag&&t.frag.url||t.context&&t.context.url,code:t.networkDetails?t.networkDetails.status:0})})),o.on(a.Events.FRAG_BUFFERED,(function(e,t){var a=function(){try{return window.isMVK?window.audio.getCurrent():(0,j.asObject)(window.getAudioPlayer().getCurrentAudio())}catch(e){return{id:0,ownerId:0}}}(),s={owner_id:a.ownerId,audio_id:a.id,fragment_id:t.frag.sn.toString(),fragment_duration:Math.ceil(1e3*t.frag.duration).toString(),time_to_first_byte:Math.ceil(t.stats.tfirst-t.stats.trequest).toString(),time_to_first_frame:Math.ceil(t.stats.tload-t.stats.trequest).toString(),buffering_time:Math.ceil(t.stats.tbuffered-t.stats.trequest).toString()};n&&i.audioNetworkStatCollector.logEvent((0,O.__assign)((0,O.__assign)({},s),{event_type:W.AudioNetworkType.FRAGMENT_STALLED}),z.default.getConnectionType(),z.default.getConnectionEffectiveType()),n=!1,i.audioNetworkStatCollector.logEvent((0,O.__assign)((0,O.__assign)({},s),{event_type:W.AudioNetworkType.FRAGMENT_LOADED}),z.default.getConnectionType(),z.default.getConnectionEffectiveType())})),o.loadSource(t),o.attachMedia(i.audioElement),i.hlsInstance=o,e()}))}))},e.loadHls=function(){return i.e(6052).then(i.t.bind(i,51505,23))},e}();class J{constructor(e){this.type="html5",this.opts=e||{},this._audioNodes=[],this._currentAudioEl=this._createAudioNode(),this._prefetchAudioEl=this._createAudioNode()}destroy(){}getPlayedTime(){for(var e=this._currentAudioEl.played,t=0,i=0;i<e.length;i++)t+=e.end(i)-e.start(i);return t}getCurrentTime(){return this._currentAudioEl.currentTime}clearAudioNode(){this._currentAudioEl=this._createAudioNode(B)}isCurrent(e){return e===this._currentAudioEl}_createAudioNode(e){var t=this,i=new $({onBufferUpdate:()=>{this.isCurrent(i)&&this.opts.onBufferUpdate(this.getCurrentBuffered())},onProgressUpdate:()=>{this.isCurrent(i)&&i.src!==B&&this.opts.onProgressUpdate(this.getCurrentProgress(),this.getPlayedTime(),this.getCurrentTime())},onEnd:()=>{this.isCurrent(i)&&i.src!==B&&this.opts.onEnd()},onSeeked:()=>{this.isCurrent(i)&&this.opts.onSeeked()},onSeek:()=>{this.isCurrent(i)&&this.opts.onSeek()},onFail:e=>{this._prefetchAudioEl===i?this._prefetchAudioEl=this._createAudioNode():this.isCurrent(i)&&i.src!==B&&(this._hlsError=e,this.opts.onFail&&this.opts.onFail())},onDurationChange:()=>{this.isCurrent(i)&&this._seekOnReady&&i.duration>0&&(this.seek(this._seekOnReady),this._seekOnReady=!1)},onCanPlay:()=>{this.isCurrent(i)&&this.opts.onCanPlay&&this.opts.onCanPlay()},onPause:function(){t.isCurrent(i)&&i.src!==B&&t.opts.onPause(...arguments)},onPlay:function(){t.isCurrent(i)&&i.src!==B&&t.opts.onPlay(...arguments)},volume:this.hasOwnProperty("_volume")?this._volume:this.opts.defaultVolume},e);return i}onReady(e){e()}prefetch(e){this._prefetchAudioEl&&this._prefetchAudioEl.url===q(e)||(this._prefetchAudioEl=this._createAudioNode(e))}seek(e){var t=this._currentAudioEl;t.duration>0&&t.src&&t.src!==B?t.currentTime=t.duration*e:this._seekOnReady=e}setVolume(e){void 0===e&&(e=this._currentAudioEl.volume),this._currentAudioEl.volume=e,this._prefetchAudioEl&&(this._prefetchAudioEl.volume=e),this._volume=e}setPlaybackRate(e){this._currentAudioEl.playbackRate=e}getCurrentProgress(){return this._currentAudioEl.currentProgress}getCurrentBuffered(){return this._currentAudioEl&&this._currentAudioEl.currentBuffered}getDuration(){return this._currentAudioEl&&this._currentAudioEl.duration}isFullyLoaded(){return this._currentAudioEl.isFullyLoaded}setUrl(e,t){var i;if(void 0===t&&(t=()=>{}),!e)return t&&t(!1);var a=q(e),n=this._currentAudioEl;if(this._currentAudioEl.src&&this._currentAudioEl.src!==B&&(this._seekOnReady=!1),this._currentAudioEl.src===a)return this.opts.onCanPlay&&this.opts.onCanPlay(),void(t&&t(!0));if(this._prefetchAudioEl){if(this._prefetchAudioEl.src===a)return this._currentAudioEl.pause(),this._currentAudioEl.setUrl(B),this._prefetchAudioEl.readyState>=3&&setTimeout((()=>this.opts.onCanPlay&&this.opts.onCanPlay())),this._currentAudioEl=this._prefetchAudioEl,this._prefetchAudioEl=null,void(t&&t(!0));a!==B&&this._prefetchAudioEl.setUrl(B)}n.src!==a&&(i=n.setUrl(a).then((()=>this._stopFrequencyAnalise()))),i?i.then((()=>t(!0))).catch((()=>t(!1))):t(!0)}play(){this._stopFrequencyAnalise();var e=this._currentAudioEl;if(e.src){var t=e.play();return this._startFrequencyAnalise(),t}return Promise.resolve()}preparePlay(){if(f.browser.safari)return this._currentAudioEl.setUrl(B).then((()=>this._currentAudioEl.play()))}_startFrequencyAnalise(){function e(e,t,i,a){return(i-t)*e/a+t}function t(e,t){return Math.random()*(t-e)+e}this._stopFrequencyAnalise();var i=999,a=null,n=null;this._freqUpdateInterval=setInterval((()=>{var s;this._currentAudioEl.paused?s=[0,0,0,0]:(++i>3&&(i=0,a=n,n=[t(.7,1),t(.55,.8),t(.3,.55),t(.03,.45)],a||(a=[t(.7,1),t(.55,.8),t(.3,.55),t(.03,.45)])),s=[e(i,a[0],n[0],3),e(i,a[1],n[1],3),e(i,a[2],n[2],3),e(i,a[3],n[3],3)]),this.opts.onFrequency&&this.opts.onFrequency(s)}),50)}_stopFrequencyAnalise(){clearInterval(this._freqUpdateInterval),this.opts.onFrequency&&this.opts.onFrequency([0,0,0,0])}pause(){this._currentAudioEl.pause(),this._stopFrequencyAnalise()}stop(){this._currentAudioEl.pause(),this.seek(0),this._stopFrequencyAnalise()}_setFadeVolumeInterval(e){if(e){if(!this._fadeVolumeWorker&&window.Worker&&window.Blob){var t=new Blob(["\n          var interval;\n          onmessage = function(e) {\n            clearInterval(interval);\n            if (e.data == 'start') {\n              interval = setInterval(function() { postMessage({}); }, 20);\n            }\n          }\n        "]);try{this._fadeVolumeWorker=new Worker(window.URL.createObjectURL(t))}catch(e){this._fadeVolumeWorker=!1}}this._fadeVolumeWorker?(this._fadeVolumeWorker.onmessage=e,this._fadeVolumeWorker.postMessage("start")):this._fadeVolumeInterval=setInterval(e,60)}else this._fadeVolumeWorker&&(this._fadeVolumeWorker.terminate(),this._fadeVolumeWorker=null),this._fadeVolumeInterval&&clearInterval(this._fadeVolumeInterval)}fadeVolume(e,t,i){e=Math.max(0,Math.min(1,e));var a=this._currentAudioEl,n=0;if(t){var s=e-a.volume;n=s/(t/20||1)}else n=e<a.volume?-.06:.001;if(Math.abs(e-a.volume)<=.001)return this._setFadeVolumeInterval(),i&&i();var o=a.volume;this._setFadeVolumeInterval((()=>{!t&&n>0&&(n*=1.35),o+=n;if(n<0?o<=e:o>=e)return this.setVolume(e),this._setFadeVolumeInterval(),i&&i();this.setVolume(o)}))}getErrorData(){var e=this._currentAudioEl.error||{};return{is_hls:this._currentAudioEl.hls?1:0,url:this._currentAudioEl.src,error_code:e.code,error_message:e.message,hls_error:this._hlsError?JSON.stringify(this._hlsError):null}}}!function(e){e.URL="url",e.PLAYBACK_RATE="playback_rate",e.DELAY="delay",e.SEEK="seek",e.PAUSE="pause",e.PLAY="play",e.VOL_SET="vol_set",e.VOL_UP="vol_up",e.VOL_DOWN="vol_down"}(Q||(Q={}));var Z=function(){function e(e){this.impl=e,this.taskIDCounter=1,this.tasks=[],this.taskInProgress=null,this.taskAbort=null}return e.prototype.newTask=function(e,t){var i,a,n=new Promise((function(e,t){i=e,a=t}));return this.tasks.push({name:e,fn:function(){return t().then(i).catch(a)},id:e+"_"+this.taskIDCounter++}),this.doTasks(),n},e.prototype.clearAllTasks=function(){this.taskAbort=this.taskInProgress,this.taskInProgress=null,this.tasks=[]},e.prototype.clearTask=function(e){this.tasks=this.tasks||[],this.tasks=this.tasks.filter((function(t){return t.name!==e}))},e.prototype.doTasks=function(){var e=this;if(!this.taskInProgress){var t=this.tasks.shift();t&&(this.taskInProgress=t.id,this.ensureImplReady().then((function(){return t.fn()})).then((function(){e.taskAbort!==t.id?(e.taskInProgress=null,e.doTasks()):e.taskAbort=null})))}},e.prototype.ensureImplReady=function(){var e=this;return new Promise((function(t){return e.impl.onReady(t)}))},e.prototype.delay=function(e){return this.newTask(Q.DELAY,(function(){return new Promise((function(t){return function(e,t){if(!window.Worker||!window.Blob)return setTimeout(e,t);var i=new Blob(["\n      var timeout;\n      onmessage = function(e) {\n        clearTimeout(timeout);\n        if (e.data == 'start') {\n          timeout = setTimeout(function() { postMessage({}); }, "+t+");\n        }\n      }\n    "]);try{var a=new Worker(window.URL.createObjectURL(i));return a.onmessage=function(){a.terminate(),e()},a.postMessage("start"),a}catch(i){return setTimeout(e,t)}}(t,e)}))}))},e.prototype.setUrl=function(e){var t=this;return this.newTask(Q.URL,(function(){return new Promise((function(i){return t.impl.setUrl(e,i)}))}))},e.prototype.seekImmediate=function(e){this.impl.seek(e)},e.prototype.seek=function(e){var t=this;return this.clearTask(Q.SEEK),this.newTask(Q.SEEK,(function(){return new Promise((function(i){t.seekImmediate(e),i()}))}))},e.prototype.pause=function(){var e=this;return this.newTask(Q.PAUSE,(function(){return new Promise((function(t){e.impl.pause(),t()}))}))},e.prototype.play=function(){var e=this;return window.browser.safari&&this.impl.play(),this.newTask(Q.PLAY,(function(){return new Promise((function(t,i){e.impl.play().then(t).catch(i)}))}))},e.prototype.setVolume=function(e,t,i){var a=this;if(void 0===i&&(i=null),t){var n=e?Q.VOL_UP:Q.VOL_DOWN;return this.newTask(n,(function(){return new Promise((function(t){return a.impl.fadeVolume(e,i,(function(){return t()}))}))}))}return this.newTask(Q.VOL_SET,(function(){return new Promise((function(t){a.impl.setVolume(e),t()}))}))},e.prototype.updatePlaybackRate=function(e){var t=this;return this.newTask(Q.PLAYBACK_RATE,(function(){return new Promise((function(i){t.impl.setPlaybackRate(e),i()}))}))},e}();function ee(e){return(0,A.geByClass)("audio_item_"+e)}function te(e){return ee(e)[0]}function ie(e){var t=te(e);if(!t)return null;if(t.dataset&&t.dataset.playlistId)return t.dataset.playlistId;var i=(0,A.gpeByClass)("AudioPlaylistRoot",t);if(!i)return console.log("no playlist Element found"),null;var a=i.dataset.playlistId;return a||(console.log("no playlist Id found"),null)}var ae=i(20587),ne=i(32911);var se=function(){var e=(0,A.ssGet)("audio_vol"),t="number"==typeof e?e:.8,i=new J({onPause:function(){(0,y.statlogsValueEvent)("mvk_audio_player_listening",_[p].id,se.getCurrentProgress()),E&&(E=!1,ssSet("audio_play","0"),clearTimeout(P));s.emit(v.events.PAUSE,O())},onPlay:function(){E||(E=!0,ssSet("audio_play","1"),clearTimeout(P),P=setTimeout(R,100));if(audioBackgroundRestriction&&audioBackgroundRestriction.isIdle)return void se.pause();s.emit(v.events.PLAY,O())},onBufferUpdate:function(e){s.emit(v.events.BUFFERED,O(),e,se.duration())},onEnd:function(){if(o>0)return;s.emit(v.events.ENDED,O()),I?(I=!1,se.next()):w=!0},onProgressUpdate:function(e,t,a){if(oe.isPlaying())return;if(!e&&a)try{e=a/se.duration()}catch(e){}s.emit(v.events.PROGRESS,O(),e,se.duration(),t),e>.01&&(k=t);ssSet("audio_pos",e),!I&&i.getDuration()-i.getCurrentTime()<.5&&(I=!0);if(e>.8&&S){var n=function(){var e=p+1;if(e&&_&&e<_.length)return _[e];return null}();n&&i.isFullyLoaded()&&(S=!1,function(e){e&&e.url&&i.prefetch(e.url)}(n))}w&&(w=!1,se.next())},defaultVolume:t}),n=new Z(i),s=new F,o=0,r=null,l={},u=null,d=new N,c=!1,h=srand(),_=[],p=null,f={},g="",m=null,E=!1,w=!1,I=!1,P=null,C=!1,T=!1,S=!1,k=0;function M(e,t){if(void 0===t&&(t=!1),!se.support)return!1;if(i.getCurrentTime()>5&&-1===e)n.seek(0);else{var a;if(E&&se.pause(),s.emit(v.events.DESELECT,D()),(a=se.canRepeat!==ne.audioRepeat.ONE||t?p+e:p)>=_.length||a<0){if(se.canRepeat!==ne.audioRepeat.ALL&&se.canRepeat!==ne.audioRepeat.ONE)return!1;a=a>=_.length?0:Math.max(0,_.length-1)}(0,y.statlogsValueEvent)("mvk_audio_player_listening",_[p].id,se.getCurrentProgress());var o=_[a];!function(e){return!!e&&!!((e=(0,j.asObject)(e)).flags&ae.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_CLAIMED_BIT)}(o)?se.play(o.fullId).then((t=>{t||M(e>0?e+1:e-1)})).catch((()=>{})):M(e>0?e+1:e-1)}}function D(){return _[p]||!1}function O(){return D().fullId||!1}function U(e){return function(e){return new Promise(((t,i)=>{var a=[];if(l=l||{},e){if(e.url)t(e);else if(!l[e.fullId]){var n=f[e.fullId];if(n>=0)for(var s=n;s<n+3;s++){var o=_[s];o&&!o.url&&!l[o.fullId]&&o.urlHash&&(a.push(o.fullId+"_"+o.actionHash+"_"+o.urlHash),l[o.fullId]=!0)}}u&&!a.length||(u=new Promise(((e,t)=>{ajax.post("/audio",{act:"reload_audio",ids:a.join(",")},{onDone:t=>{r=null,e(t)},onFail:t})}))),r&&r(),r=i,u.then((a=>{a?a.forEach((i=>{var a=(0,j.asObject)(i),n=_[f[a.fullId]];n&&(n.url=a.url),ee(a.fullId).forEach((e=>{try{var t=JSON.parse(e.dataset.audio);t[ae.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_URL]=a.url,e.dataset.audio=JSON.stringify(t)}catch(e){}})),a.fullId===e.fullId&&(e.url=a.url,t(e)),delete l[a.fullId]})):i(a)})).catch(i)}else i()})).catch((()=>{throw l={},new Error}))}(e).then((e=>{n.clearTask(Q.URL);var t=e.url;if(!t)throw new Error;return n.setUrl(t).then((t=>{t?o=0:(n.clearAllTasks(),s.emit(v.events.FAILED),E&&o<2&&(e.pause(),e.next(),o++))}))}))}function R(){if(E){var e=lsGet("audio_current_player");h!=e?se.pause():P=setTimeout(R,100)}}function x(e){ssSet("audio_query",e),C&&(0,L.setCookie)(C+"q",encodeURIComponent(e),1)}return{support:!0,canRepeat:ne.audioRepeat.ALL,shuffled:!1,onInit:(0,a.default)(),init:function(e){!T&&se.support&&(T=!0,e.cookie&&(C=e.cookie,e.cookie_path||"/"),onDOMReady((function(){!function(e){var t=(0,A.ssGet)("audio_id"),i=(0,A.ssGet)("audio_pos"),a=(0,L.getCookie)(C+"_playlist");e.playlist&&e.playlist.length&&(a&&se.setPlaylistId(a),se.playlist((e.playlist||[]).map(j.asObject),{q:e.playlist_q||""})),t&&se.select(t).then((()=>{i<1&&se.setPosition(i,!0)})).catch((()=>{}))}(e),se.onInit()})))},subscribe:(e,t)=>s.subscribe(e,t),unsubscribe:(e,t)=>s.unsubscribe(e,t),notify:function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),a=1;a<t;a++)i[a-1]=arguments[a];s.emit(e,...i)},getCurrent:D,getCurrentId:O,operate:function(e){if(!se.support)return!1;!e||_[p]&&e===O()?E?se.pause():se.play():((0,y.statlogsValueEvent)("mvk_audio_player_listening",D().id,se.getCurrentProgress()),se.play(e))},setPlaylistId:function(e){e!==m&&(m=e,s.emit(v.events.PLAYLIST_CHANGED))},playing:function(){return E},select:function(e){if(!se.support)return Promise.reject();if(!e)return Promise.reject();_.length||s.emit(v.events.EMPTY_PLAYLIST,e);var t=_[f[e]];return t?(O()&&s.emit(v.events.DESELECT,D()),p=f[e],s.emit(v.events.SELECT,_[p]),U(t).then((()=>{S=!0,s.emit(v.events.PLAY_REQUESTED,_[p]);var t,i=ie(e);return i&&se.setPlaylistId(i),t=O(),ssSet("audio_id",t),C&&((0,L.setCookie)(C,t,1),(0,L.setCookie)(C+"_playlist",m,1)),_[p]})).catch((()=>s.emit(v.events.DESELECT,t)))):(s.emit(v.events.NOT_FOUND_PLAYLIST,e),Promise.reject())},autoplay:function(e){se.play(e)},getCurrentPlaylistId:function(){return m},play:function(e){if(se.support)return new Promise((t=>{var a=e===O();return E&&a?(se.pause(),t(!0)):oe.isPlaying()?(e&&!a?(se.select(e).catch((()=>{})),oe.resume()):E?oe.pause():oe.resume(),t(!0)):(E=!0,!e||a?(this._play(),t(!0)):(i.setUrl(B),void se.select(e).then((()=>{n.clearAllTasks(),oe.startPlay(_[f[e]],(()=>(this._play(),t(!0))))})).catch((e=>(console.log(e),E=!1,O()&&se.select(O()),t(!1))))))}))},_play:function(){D()&&(n.play().then((()=>{ssSet("audio_play","1"),d.connect()})).catch((()=>{E=!1,s.emit(v.events.PAUSE)})),lsSet("audio_current_player",h))},clearCurrentPlaylist:function(){if(!se.support)return!1;E&&!oe.isPlaying()&&se.pause(),D()&&s.emit(v.events.DESELECT,D()),_=[],g="",p=null,se.setPlaylistId(null),f={},x(g)},pause:function(){if(!se.support)return!1;E&&(oe.isPlaying()?oe.pause():i.pause(),E=!1,ssSet("audio_play","0"))},getDeviceId:function(){var e=lsGet("audio_player_device_id");return e||(e=H()(),lsSet("audio_player_device_id",e)),e},getPosition:()=>se.isAdsPlaying()?oe.getCurrentProgress()*oe.getDuration():i.getCurrentTime(),getCurrentProgress:()=>se.isAdsPlaying()?oe.getCurrentProgress():i.getCurrentProgress(),setPosition:function(e,t){if(!se.support)return!1;var i=0;t?i=e:e&&se.duration()&&(i=e/se.duration()),n.seek(i).then((()=>{ssSet("audio_pos",i),s.emit(v.events.SEEK,O(),i,se.duration())}))},volume:function(e){if(!se.support)return!1;if(void 0===e)return t;var i=Math.min(1,Math.max(0,e));t=i,n.setVolume(t),ssSet("audio_vol",t),oe.updateVolume(),s.emit(v.events.VOLUME,O(),t)},loaded:function(){return i.getCurrentBuffered()},duration:function(){if(this.isAdsPlaying())return oe.getDuration();var e=i.getDuration(),t=_[p]&&_[p].duration;return e||t||0},played:()=>i.getPlayedTime(),getListenedTime:function(){return k},next:function(e){return void 0===e&&(e=!1),M(1,e)},prev:function(e){return void 0===e&&(e=!1),M(-1,e)},shuffle:()=>{var e=se.isPlaying()&&!se.isAdsPlaying(),t=se.getPosition(),i=se.getCurrentId();se.pause(),se.shuffled=!se.shuffled,se.shuffled?(_.forEach(((e,t)=>e.position=t)),_.sort((()=>Math.random()-.5))):_.sort(((e,t)=>e.position-t.position)),f=_.reduce(((e,t,i)=>(e[t.fullId]=i,e)),{}),i&&(se.select(i),se.setPosition(t),e&&requestAnimationFrame((()=>se.play())))},repeat:()=>{switch(se.canRepeat){case ne.audioRepeat.NONE:se.canRepeat=ne.audioRepeat.ALL;break;case ne.audioRepeat.ALL:se.canRepeat=ne.audioRepeat.ONE;break;case ne.audioRepeat.ONE:default:se.canRepeat=ne.audioRepeat.NONE}},playlist:function(e,t){return!!se.support&&(void 0===e?_:(E&&!oe.isPlaying()&&se.pause(),D()&&s.emit(v.events.DESELECT,D()),_=e,g=t&&t.q||"",p=null,f={},each(e,((e,t)=>f[t.fullId]=e)),void x(g)))},addToPlaylist:function(e,t){var i={},a=t||_.length;_.forEach((e=>i[e.fullId]=!0)),e.forEach((e=>{i[e.fullId]||(t?_.splice(a,0,e):_.push(e))})),_.forEach(((e,t)=>{f[e.fullId]=t}))},playlist_q:function(){return g},setIsPlaying:function(e){E=e},isAdsPlaying:function(){return oe.isPlaying()},isPlaying:function(){return E},initSplash(){c||(window.audioRestrictionSplash=new b,c=!0)},playNothing:()=>{i.setUrl(B,(()=>{}))},seek:n.seek,events:v.events}}();window.Artist=class{static follow(e,t,i,a){s.default.setLoading(a,!0),ajax.post("/audio",{_ajax:1,act:"artist_follow",ref:t,hash:i,artist_id:e},{onDone:i=>{a.dataset.hash=i,a.dataset.id=e,a.dataset.ref=t,window.audioplayer.emitCatalogEvent(n.CatalogEvent.ArtistFollow),s.default.setLoading(a,!1)},onFail:()=>unlockButton(a)})}static unfollow(e,t,i,a){s.default.setLoading(a,!0),ajax.post("/audio",{_ajax:1,act:"artist_unfollow",ref:t,hash:i,artist_id:e},{onDone:i=>{a.dataset.hash=i,a.dataset.id=e,a.dataset.ref=t,window.audioplayer.emitCatalogEvent(n.CatalogEvent.ArtistUnfollow),s.default.setLoading(a,!1)},onFail:()=>unlockButton(a)})}static trackToOfficial(e,t){ajax.post("/audio",{_ajax:1,act:"artist_track_to_official",hash:e,url:t})}},window.Curator=class{static follow(e,t,i){s.default.setLoading(i,!0),ajax.post("curator.php",{_ajax:1,act:"follow",hash:t,curator_id:e},{onDone:t=>{i.dataset.hash=t,i.dataset.curatorId=e,window.audioplayer.emitCatalogEvent(n.CatalogEvent.CuratorFollow)},onFail:()=>!0}).promise.finally((()=>s.default.setLoading(i,!1)))}static openUnfollowActionsheet(e,t,i){u=i;var a=o.default.elem((0,r.default)({items:[(0,r.ModalMenuBtn)({inner:(0,l.getLang)("audio_unfollow_owner_button"),onclick:["Curator.unfollow",e,""+t]})],close:!0}));(0,r.open)(a)}static unfollow(e,t,i){(0,r.close)(),!i&&u&&(i=u),s.default.setLoading(i,!0),ajax.post("curator.php",{_ajax:1,act:"unfollow",hash:t,curator_id:e},{onDone:t=>{i.dataset.hash=t,i.dataset.curatorId=e,window.audioplayer.emitCatalogEvent(n.CatalogEvent.CuratorUnfollow),s.default.setLoading(i,!1)},onFail:()=>s.default.setLoading(i,!1)})}},window.MusicOwner=h;var oe=new m(new class{constructor(e){this.audioplayer=e}notify(e){var t=this.audioplayer.getCurrent();switch(e){case v.events.AD_COMPLETED:case v.events.AD_STARTED:this.audioplayer.notify(e,t);break;case v.events.PAUSE:case v.events.PLAY:this.audioplayer.notify(e,t.fullId);break;case v.events.PROGRESS:for(var i=arguments.length,a=new Array(i>1?i-1:0),n=1;n<i;n++)a[n-1]=arguments[n];this.audioplayer.notify(e,t.fullId,...a)}}setIsPlaying(e){this.audioplayer.setIsPlaying(e)}getVolume(){var e=(0,A.ssGet)("audio_vol");return null===e?1:e}_getPlayingContextSection(){return window.playerAdapter.getContext()}}(se),null,!0);se.ads=oe,window.audio=se,window.AudioBackgroundRestriction=M,window.audioBackgroundRestriction=null,document.addEventListener("DOMContentLoaded",(function(){(0,w.partConfigEnabled)("audio_mvk_background_restriction_enabled")&&(window.audioBackgroundRestriction=new M)})),document.addEventListener("DOMContentLoaded",(()=>{"audio"===cur.module&&se.initSplash()})),window.page.onChange((()=>{"audio"===cur.module?se.initSplash():window.audioRestrictionSplash&&window.audioRestrictionSplash.popup&&window.audioRestrictionSplash.close()}));var re=i(85863),le=i(71437);var ue=i(9720),de="start",ce="stop",he="volume",_e="rewind",pe="play_further",fe="default",ve="next_track",ye="prev_track",me="auto",Ee="interruption",Ae="pause",we="new",Ie="close_app",Pe="queue",be="pause",Ce="session_end",Te={[de]:1,[ce]:2,[he]:3,[_e]:4,[pe]:5,added:6,removed:7,recommendation_removed:8,show_album:9,share_audio:10,broadcast:11,curator:12},Se={[fe]:1,[ve]:2,[ye]:3,[me]:4,[Ee]:5,[Ae]:6,[we]:7,[Ie]:8,[Pe]:9,[be]:10,upload:11,on:12,off:13,follow:14,unfollow:15},ke="audio_unique_unauth_id";class Le{constructor(e){if(this.playerAdapter=e,this.listenedData=null,this.sendTimeout=null,this.currentAudioId=null,this.currentAudio=null,this.currentAudioTrackCode=null,this.pausedAudioId=null,this.playlistChanged=!1,this.currentPosition=0,this.currentListened=0,this.playedTime=0,this.adsCompleted=!1,this.wasEnded=!1,vk.id)this.uniqueUserId=null;else{var t=K.default.get(ke);t?this.uniqueUserId=t:(this.uniqueUserId=H()(),K.default.set(ke,this.uniqueUserId))}this.debug=e.isDebug(),this.onVolume=(0,ue.debounce)(this.onVolume.bind(this),300),this.playerAdapter.listenPlay(this.onPlay,this),this.playerAdapter.listenPause(this.onPause,this),this.playerAdapter.listenStop(this.onPause,this),this.playerAdapter.listenProgress(this.onProgress,this),this.playerAdapter.listenVolume(this.onVolume,this),this.playerAdapter.listenSeek(this.onSeek,this),this.playerAdapter.listenPlaylistChanged(this.onPlaylistChanged,this),this.playerAdapter.listenEnded(this.onEnded,this),this.playerAdapter.listenPlayNext(this.onPlayNext,this),this.playerAdapter.listenAdCompleted(this.onAdCompleted,this),this.onPageClose=this.onPageClose.bind(this)}listenOnBeforeUnload(){addEvent(window,"beforeunload",this.onPageClose)}stopListenOnBeforeUnload(){removeEvent(window,"beforeunload",this.onPageClose)}canOperate(){return!this.playerAdapter.isPodcast()&&!this.playerAdapter.isArticleTts()&&!this.playerAdapter.isAdPlaying()}getCurrentAudioParams(){var e=this.currentAudioId||this.playerAdapter.getAudioId();if(e){var[t,i]=e.split("_");return{ownerId:t,audioId:i,trackCode:this.currentAudioTrackCode||this.playerAdapter.getAudioTrackCode()}}return{}}getEnvParams(){return{state:this.playerAdapter.getState(),context:this.playerAdapter.getContext(),ref:window.cur&&vk.widget?String(cur.widgetReferrer||"").substring(0,20):""}}getListenedTime(){return Math.round(this.playerAdapter.getListenedTime())||0}getPlaySubtype(){if(this.playerAdapter.isAutoPlayed())return me;var e=this.playerAdapter.getSequence();if(e)return e>0?ve:ye;var t=this.pausedAudioId,i=this.playerAdapter.getAudioId();return t&&i===t?Ae:we}onPlay(){if(this.canOperate()){var e=this.playerAdapter.getAudio(),t=e.fullId,i=this.currentAudioId===t||!this.currentAudioId,a=this.currentAudioId!==this.pausedAudioId,n=this.playerAdapter.getListenedTime();!i&&a&&this.onTrackSwitch(this.currentAudio,this.currentPlaylistId),this.playedTime=Date.now(),this.currentAudioId=t,this.currentAudio=e,this.currentAudioTrackCode=this.playerAdapter.getAudioTrackCode(),this.currentPlaylistId=this.playerAdapter.getPlaylistId(),this.wasEnded||this.playerAdapter.hasPrevAudio()&&(!this.pausedAudioId||this.playerAdapter.isAutoPlayed())?(this.currentPosition=0,n=0):this.currentPosition=this.playerAdapter.getProgressInSeconds(),this.currentListened=n,this.sendCurrentAudioEvent({type:de,subtype:this.getPlaySubtype(),position:this.currentPosition,listened:n}),this.pausedAudioId=null,this.playlistChanged=!1,this.wasEnded=!1,this.listenOnBeforeUnload()}}onPause(){var e=this.playerAdapter.getAudioId();if(this.canOperate()&&e){var t=this.collectListenedData();this.sendListenedDataDelayed(1e3,t),setTimeout((()=>{if(!(this.currentAudio&&e!==this.currentAudio.fullId||Date.now()-this.playedTime<150)){this.pausedAudioId=e;var t=this.playerAdapter.getPausedBy(this.playedTime);this.sendCurrentAudioEvent({type:ce,subtype:t?t===Pe?Pe:Ee:be})}}),100),this.stopListenOnBeforeUnload()}}onProgress(){this.playerAdapter.getProgress()<.01||!this.playerAdapter.isPlaying()||(this.currentPosition=this.playerAdapter.getProgressInSeconds(),this.currentListened=this.playerAdapter.getListenedTime(),!this.pausedAudioId&&Date.now()-this.playedTime>150&&this.collectListenedData(),this.adsCompleted&&(this.sendCurrentAudioEvent({type:de,subtype:this.getPlaySubtype(),position:this.currentPosition}),this.adsCompleted=!1))}onVolume(){this.canOperate()&&this.sendCurrentAudioEvent({type:he,subtype:fe})}onSeek(){if(this.canOperate()){var e={position:this.currentPosition,positionTo:this.playerAdapter.getProgressInSeconds()};e.position!==e.positionTo&&this.sendCurrentAudioEvent((0,re.default)({type:_e,subtype:fe},e))}}onPlaylistChanged(){this.canOperate()&&(this.playlistChanged=!0)}onEnded(){this.listenedData&&this.playerAdapter.isLastTrack()&&(this.listenedData.end_stream_reason=Ce),this.wasEnded=!0,this.playerAdapter.isRepeatCurrentAudio()?(this.sendCurrentAudioEvent({type:ce,subtype:me}),this.collectListenedData(),this.sendListenedData()):this.sendListenedDataDelayed(150)}onPlayNext(e,t){if(this.canOperate()){var[i,a]=t.split("_");this.sendAudioEvent({type:pe,subtype:fe,ownerId:i,audioId:a})}}onAdCompleted(){this.adsCompleted=!0}onTrackSwitch(e,t){if(e){var i=we,a=this.playerAdapter.getSequence(),[n,s]=e.fullId.split("_");this.playerAdapter.isAutoPlayed()?i=me:a&&(i=a>0?ve:ye),this.sendCurrentAudioEvent({type:ce,subtype:i,position:this.currentPosition,listened:this.currentListened,trackCode:e.trackCode,playlistId:t,ownerId:n,audioId:s}),this.wasEnded=!0,this.collectListenedData(e),this.collectListenedDataSwitch();var o=this.listenedData;this.listenedData=null,this.sendListenedData(o)}}onPageClose(){this.playerAdapter.isPlaying()&&(this.sendCurrentAudioEvent({type:ce,subtype:Ie}),this.sendListenedData())}collectListenedDataSwitch(){if(this.listenedData){if(this.listenedData.end_stream_reason===Ce)return;var e=this.playerAdapter.isAutoPlayed(),t=this.getListenedTime(),i=this.playerAdapter.getSequence(),a=null;i&&!e?a=i>0?"next_btn":"prev":this.playlistChanged&&(a="playlist_change"),!a&&e&&(a="playlist_next"),this.listenedData.end_stream_reason=a||"new",t&&(this.listenedData.listened=t)}}collectListenedData(e){void 0===e&&(e=null);var t=e||this.currentAudio;if(this.canOperate()&&t){var i=t.fullId,a=t.trackCode||this.playerAdapter.getAudioTrackCode(),n=this.getListenedTime(),s=t.urlHash;if(s||console.log("no url hash"),n&&s){var o={audio_id:i,listened:n,context:this.playerAdapter.getContext(),hash:s};return window.cur&&vk.widget&&(o.ref=cur.widgetReferrer||""),this.playerAdapter.hasSearchParams()&&(o.search_params=JSON.stringify(this.playerAdapter.getSearchParams())),this.playerAdapter.hasPlaylist()&&(this.playerAdapter.isRealPlaylist()&&(o.playlist_id=this.playerAdapter.getPlaylistId()),this.playerAdapter.isShuffledPlaylist()&&(o.shuffled=1)),a&&(o.track_code=a),this.playerAdapter.isRepeatCurrentAudio()?o.repeat="one":this.playerAdapter.isRepeatAll()&&(o.repeat="all"),this.playerAdapter.isAutoPlayed()&&(o.auto=1),this.playerAdapter.hasPrevAudio()&&(o.prev_audio_id=this.playerAdapter.getPrevAudioId()),this.playerAdapter.hasPrevPlaylist()&&this.playerAdapter.isRealPrevPlaylist()&&(o.prev_playlist_id=this.playerAdapter.getPrevPlaylistId()),this.playerAdapter.isPlaying()||(o.end_stream_reason="stop_btn"),o.state=document.hidden?"background":"app",this.listenedData=o,this.sendListenedDataDelayed(1e4,o),o}}}sendListenedData(e){void 0===e&&(e=null),clearTimeout(this.sendTimeout);var t=e||this.listenedData;this.listenedData=null,t&&t.listened&&(this.uniqueUserId&&(t.unique_id=this.uniqueUserId),this.playerAdapter.sendListenedData(t))}sendListenedDataDelayed(e,t){void 0===e&&(e=0),void 0===t&&(t=null),clearTimeout(this.sendTimeout),this.sendTimeout=setTimeout((()=>this.sendListenedData(t)),e)}serializeEvent(e){var t=[Te[e.type],Se[e.subtype],1];return e.audioId?t.push(e.ownerId+"_"+e.audioId):t.push(0),e.trackCode?t.push(e.trackCode):t.push(0),e.state?t.push(e.state):t.push(0),e.ref?t.push(e.ref):t.push(""),e.context?t.push(e.context):t.push("other"),e.volume||0===e.volume?t.push(e.volume):t.push(this.playerAdapter.getVolume()),e.position||0===e.position?t.push(e.position):t.push(this.playerAdapter.getProgressInSeconds()),e.shuffle?t.push(e.shuffle?1:0):t.push(0),e.repeat?t.push(e.repeat):t.push(0),e.listened?t.push(Math.max(e.listened,0)):t.push(0),e.playlistId?t.push(e.playlistId):t.push(""),e.targetOwnerId?t.push(e.targetOwnerId):t.push(0),this.uniqueUserId?t.push(this.uniqueUserId):t.push(""),e.positionTo?t.push(e.positionTo):t.push(null),t}sendEvent(e){this.debug&&(console.log("audio stats event",e.type,e.subtype,e),window._statForTest||(window._statForTest=[]),window._statForTest.push(e)),(0,y.statlogsValueEvent)("audio_sts",...this.serializeEvent(e))}sendCurrentAudioEvent(e){this.sendEvent((0,re.default)({shuffle:this.playerAdapter.isShuffledPlaylist(),repeat:this.playerAdapter.isRepeatCurrentAudio()?1:this.playerAdapter.isRepeatAll()?2:0,volume:this.playerAdapter.getVolume(),position:this.playerAdapter.getProgressInSeconds(),listened:this.getListenedTime(),playlistId:this.playerAdapter.getPlaylistId()},this.getEnvParams(),{},this.getCurrentAudioParams(),{},e))}sendAudioEvent(e){var t=(0,re.default)({},e,{},this.getEnvParams());!vk.id&&this.uniqueUserId&&(t.uniqueUnauthId=this.uniqueUserId),this.sendEvent(t)}destroy(){this.playerAdapter.unListenAll(),this.stopListenOnBeforeUnload(),this.playerAdapter=null,this.listenedData=null,clearTimeout(this.sendTimeout)}}var Me="group_list",De="search",Oe="other";class Ue extends class{constructor(e){this.player=e,this.listeners=[]}listen(e,t,i){var a=t.bind(i||this);this.listeners.push({event:e,fn:t,listener:a}),this.playerListen(e,a)}unListen(e,t){var i=-1;if((0,_.each)(this.listeners,((a,n)=>{if(n.event===e&&n.listener===t)return i=a,!1})),!(i<0)){var a=this.listeners[i];this.playerUnListen(e,a.listener),this.listeners.splice(i,1)}}unListenAll(){for(var e;e=this.listeners[0];)this.unListen(e.event,e.listener)}listenPlay(e,t){this.listen(v.events.PLAY,e,t)}listenPause(e,t){this.listen(v.events.PAUSE,e,t)}listenStop(e,t){this.listen("stop",e,t)}listenProgress(e,t){this.listen(v.events.PROGRESS,e,t)}listenVolume(e,t){this.listen(v.events.VOLUME,e,t)}listenSeek(e,t){this.listen(v.events.SEEK,e,t)}listenPlaylistChanged(e,t){this.listen(v.events.PLAYLIST_CHANGED,e,t)}listenEnded(e,t){this.listen(v.events.ENDED,e,t)}listenPlayNext(e,t){this.listen(v.events.PLAY_NEXT,e,t)}listenAdCompleted(e,t){this.listen(v.events.AD_COMPLETED,e,t)}playerListen(e,t){this.player.subscribe(e,t)}playerUnListen(e,t){this.player.unsubscribe(e,t)}getPausedBy(){return null}getState(){return document.hidden?1:3}getProgress(){return this.player.playerGetProgress()}getProgressInSeconds(){return this.player.getProgressInSeconds()}getVolume(){return this.player.getVolume()}getAudioId(){return this.player.getAudioId()}getAudio(){return this.player.getAudio()}getAudioTrackCode(){return this.player.getAudioTrackCode()}getPrevAudioId(){return this.player.getPrevAudioId()}getPrevPlaylistId(){return this.player.getPrevPlaylistId()}getPlaylistId(){return this.player.getPlaylistId()}getContext(){return this.player.getContext()}getSequence(){return this.player.getSequence()}getType(){return this.player.getType()}getListenedTime(){return isNaN(this.player.getListenedTime())?0:Math.round(this.player.getListenedTime())}getSearchParams(){return this.player.getSearchParams()}isPlaying(){return this.player.isPlaying()}isAutoPlayed(){return this.player.isAutoPlayed()}isRepeatCurrentAudio(){return this.player.isRepeatCurrentAudio()}isRepeatAll(){return this.player.isRepeatAll()}isShuffledPlaylist(){return this.player.isShuffledPlaylist()}isRealPlaylist(){return this.player.isRealPlaylist()}isRealPrevPlaylist(){return this.player.isRealPrevPlaylist()}isPodcast(){return this.player.isPodcast()}isArticleTts(){return this.player.isArticleTts()}isAdPlaying(){return this.player.ads.isPlaying()}isLastTrack(){return this.player.isLastTrack()}hasPrevAudio(){return this.player.hasPrevAudio()}hasPrevPlaylist(){return this.player.hasPrevPlaylist()}hasPlaylist(){return this.player.hasPlaylist()}hasSearchParams(){return this.player.hasSearchParams()}isDebug(){return!1}sendListenedData(e){return this.player.sendListenedData(e)}}{getPausedBy(e){return ge("StoriesView")?"stories":null}getState(){var e=super.getState(),t=this.getAudioId();return t&&ge("audio"+t)?2:e}getProgress(){var e=this.player.getCurrent();return e?this.player.getPosition()/e.duration:0}getProgressInSeconds(){return Math.round(this.player.getPosition())}getVolume(){return Math.round(100*this.player.volume())}getAudioId(){return this.player.getCurrentId()}getAudio(){return this.player.getCurrent()}getAudioTrackCode(){try{return this.player.getCurrent().trackCode}catch(e){return!1}}getPrevAudioId(){var e=this.getAudioId(),t=window.audioplayer.getPlaybackQueue();if(e){var i=t.lastIndexOf(e);if(-1!==i)return t[i-1]}}getPlaylistIdFromAudioId(e){return ie(e)}getPlaylistTypeFromAudioId(e){if(e&&isString(e)){var[t,i,a,n]=e.split("_");return t&&i?a&&0===a.indexOf("playlist")?a.replace("playlist","")+"_"+n:a:void 0}}getPrevPlaylistId(){return this.getPlaylistIdFromAudioId(this.getPrevAudioId())}getPlaylistId(){return this.getPlaylistIdFromAudioId(this.getAudioId())}updateContext(){var e=this.getPlaylistTypeFromAudioId(this.getAudioId());if(e){var t=this.getContextByType(e);t===Oe&&nav.getQuery("from")?this.context=this.getContextByType(nav.getQuery("from")):this.context=t}else this.context=Oe}getContextByType(e){if(void 0===e&&(e=""),0===e.indexOf("recoms"))return nav.getQuery("q")?De:"recs";if(0===e.indexOf("audios")){var t=intval(e.replace("audios",""));return t===vk.id?"my":t<0?Me:"user_list"}return 0===e.indexOf("popular")?"recs_audio":0===e.indexOf("search")?De:0===e.indexOf("wall")?Me:0===e.indexOf("mail")?"im":0===e.indexOf("feed")?"feed":Oe}getContext(){return this.context||Oe}getSequence(){return 0}getSearchParams(){return null}getType(){return"html5"}isPlaying(){return this.player.playing()}isAutoPlayed(){return window.audioplayer.isAutoPlayed()}isRepeatCurrentAudio(){return!1}isRepeatAll(){return!1}isShuffledPlaylist(){return!1}isPodcast(){return!1}isArticleTts(){return!1}isAdPlaying(){return!1}isRealPlaylist(){return!0}isRealPrevPlaylist(){return!0}isLastTrack(){var e=this.player.getCurrent(),t=this.player.playlist();return!!e&&(!(!e||t&&t.length)||t.indexOf(e)+1===t.length)}hasPrevPlaylist(){return!1}hasPlaylist(){var e=this.player.playlist();return Boolean(e&&e.length>1)}hasPrevAudio(){var e=this.getAudioId(),t=window.audioplayer.getPlaybackQueue();return Boolean(e&&t.length>1)}hasSearchParams(){return!1}isDebug(){return Boolean(lsGet("audio_stats_debug"))}sendListenedData(e){var t=nav.getQuery("from");ajax.post("/audio",{_ajax:1,act:"playback",audio:e.audio_id,track_code:e.track_code,prev:e.prev_audio_id,state:e.state,from_block:t,listened:e.listened,hash:e.hash,playlist_id:e.playlist_id,end_stream_reason:e.end_stream_reason,auto:e.auto,unique_user_id:e.unique_id})}}var Re,Ne=i(84959),Be=i(63848),xe=i(26289),He=i(59866),Fe=i(38574),Ve=i(40517),Ye=i(79654),qe=function(){function e(e,t){var i=this;this.blockId=t;this.observed_items=[],this.observer=new IntersectionObserver((function(e){return i.onView(e)}),{root:null,rootMargin:"0px",threshold:.5}),this.productCollector=new Ye.ProductionStatCollector,this.viewCollector=new Ye.ViewStatCollector(this.productCollector),this.clickCollector=new Ye.ClickStatCollector(this.productCollector),this.elements=e,this.addHandlers()}return e.prototype.destroy=function(){var e=this;this.observer.disconnect(),this.observed_items.forEach((function(t,i){return e.sendViewStat(i)})),this.elements.forEach((function(t){return t.removeEventListener("mousedown",e.clickHandler)}))},e.prototype.addHandlers=function(){var e=this;this.clickHandler=this.onClick.bind(this),this.elements.forEach((function(t){return t.addEventListener("mousedown",e.clickHandler)})),this.elements.forEach((function(t){return e.observer.observe(t)}))},e.prototype.onClick=function(e){if(e.currentTarget&&e.currentTarget instanceof HTMLElement&&e.currentTarget.parentElement&&e.currentTarget.dataset.id){var t=parseInt(e.currentTarget.dataset.id),i={type:Ve.ClickProductionStatEventTypes.TYPE_CATALOG_BANNER_ITEM,position:(0,O.__spreadArray)([],(0,O.__read)(e.currentTarget.parentElement.children),!1).indexOf(e.currentTarget)+1},a={type:Ve.EventItemType.CATALOG_BANNER,id:t,track_code:this.blockId};this.clickCollector.logEvent(i,a)}},e.prototype.sendViewStat=function(e){if(void 0!==this.observed_items[e]){var t=(0,O.__assign)((0,O.__assign)({},this.observed_items[e]),{end_view:this.productCollector.getCurrentTime()}),i={type:Ve.EventItemType.CATALOG_BANNER,id:e,track_code:this.blockId};this.viewCollector.logEvent(t,i),delete this.observed_items[e]}},e.prototype.onView=function(e){var t=this;e.forEach((function(e){var i=e.target;if(i instanceof HTMLElement&&i.parentElement&&i.dataset.id){var a=parseInt(i.dataset.id);e.isIntersecting?void 0===t.observed_items[a]&&(t.observed_items[a]={type:Ve.ViewProductionStatEventTypes.TYPE_CATALOG_BANNER_ITEM,start_view:t.productCollector.getCurrentTime(),end_view:"0",position:(0,O.__spreadArray)([],(0,O.__read)(i.parentElement.children),!1).indexOf(i)+1}):t.sendViewStat(a)}}))},e}();!function(e){e.Click="click",e.Close="close"}(Re||(Re={}));var Xe=function(){function e(e,t){this.blockContent=e,this.blockId=t;var i=this.getBanners();this.bannerStatCollector=new qe(i,t)}return e.prototype.getBanners=function(){return Array.from(this.blockContent.querySelectorAll(".BannerItem"))},e.prototype.setBannersEvents=function(){var e=this;this.getBanners().forEach((function(t){if(t.dataset.id){var i=parseInt(t.dataset.id);e.addConsumableClick(t,i),e.addConsumableCloseClick(t,i)}}))},e.prototype.checkItems=function(){this.getBanners().length||this.blockContent&&this.blockContent.remove()},e.prototype.destroy=function(){this.bannerStatCollector.destroy()},e}(),je=i(12334),We=function(e){function t(t,i){var a=e.call(this,t,i)||this;return a.initLoop(),a.truncateTexts(),a.setBannersEvents(),a}return(0,O.__extends)(t,e),t.initBannerBlocks=function(){var e=document.querySelectorAll(".AudioBlock_catalog_banners");return(0,O.__spreadArray)([],(0,O.__read)(e),!1).map((function(e){return new t(e,e.dataset.blockId||"")}))},t.prototype.truncateTexts=function(){this.getBanners().forEach((function(e){var t=e.querySelector(".Banner__subheader");t instanceof HTMLElement&&(0,je.truncateMultilineText)(t);var i=e.querySelector(".Banner__header");i instanceof HTMLElement&&(0,je.truncateMultilineText)(i)}))},t.prototype.addConsumableClick=function(e,t){var i=this;if(e.classList.contains("BannerItem--consumable")&&e.dataset.id){var a=e.querySelector(".Banner__link");if(a instanceof HTMLElement){var n=a.onclick;a.onclick=null,a.addEventListener("click",(function(a){i.consumeBanner(t,Re.Click),i.removeBanner(t),n&&n.call(e,a)}))}}},t.prototype.addConsumableCloseClick=function(e,t){var i=this,a=e.querySelector(".Banner__dismiss");a instanceof HTMLElement&&(a.onclick=function(e){i.consumeBanner(t,Re.Close),i.removeBanner(t),i.checkItems(),e.stopPropagation(),e.preventDefault()})},t.prototype.removeBanner=function(e){this.blockContent.querySelectorAll('.BannerItem[data-id="'+e+'"]').forEach((function(e){return e.remove()})),this.loopSlider&&this.loopSlider.init()},t.prototype.initLoop=function(){if((this.blockContent.classList.contains("AudioBlock_slider")||this.blockContent.classList.contains("AudioBlock_large_slider"))&&this.blockContent.querySelector(".Slider--loop")){var e=this.blockContent.querySelector(".Slider__scroll");e instanceof HTMLElement&&(e.onwheel=null,this.loopSlider=new Fe.LoopSlider(e,this.blockContent.querySelector(".Slider__line")))}},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.loopSlider&&this.loopSlider.destroy()},t.prototype.consumeBanner=function(e,t){d.default.post("/audio",{act:"consume_banner",id:e,ref:this.blockId,reason:t})},t}(Xe),ze=i(97349),Ge=i(36461),Qe="MusicOwnerCell__followBtn",Ke=function(){function e(){}return e.handleMusicFollowEvent=function(t){var i=(0,O.__read)(e.extractParamsFromBlockButton(t,"ownerId","hash"),2),a=i[0],n=i[1],s=e.createButton("audio_following_owner_button",(0,Ge.Icon24Done)(),"MusicOwner.openUnfollowActionsheet("+a+", '"+n+"', this)",{"data-owner-id":a,"data-hash":n});t.innerHTML=s},e.handleMusicUnfollowEvent=function(t){var i=(0,O.__read)(e.extractParamsFromBlockButton(t,"ownerId","hash"),2),a=i[0],n=i[1],s=e.createButton("audio_follow_owner_button",(0,Ge.Icon24Add)(),"MusicOwner.follow("+a+", '"+n+"', this)",{"data-owner-id":a,"data-hash":n});t.innerHTML=s},e.handleCuratorFollowEvent=function(t){var i=(0,O.__read)(e.extractParamsFromBlockButton(t,"curatorId","hash"),2),a=i[0],n=i[1],s=e.createButton("audio_following_curator_button",(0,Ge.Icon24Done)(),"Curator.openUnfollowActionsheet("+a+", '"+n+"', this)",{"data-curator-id":a,"data-hash":n});t.innerHTML=s},e.handleCuratorUnfollowEvent=function(t){var i=(0,O.__read)(e.extractParamsFromBlockButton(t,"curatorId","hash"),2),a=i[0],n=i[1],s=e.createButton("audio_follow_curator_button",(0,Ge.Icon24Add)(),"Curator.follow("+a+", '"+n+"', this)",{"data-curator-id":a,"data-hash":n});t.innerHTML=s},e.extractParamsFromBlockButton=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var a=e.querySelector("."+Qe);return a instanceof HTMLElement?t.map((function(e){return a.dataset[e]||""})):[]},e.createButton=function(e,t,i,a){return o.default.render((0,s.default)({children:(0,A.getLang)(e),icon:t,theme:"secondary",className:Qe,onclick:i,use_native_onclick:!0,attrs:a}))},e}(),$e=function(){function e(){}return e.handleMusicUnfollowEvent=function(t){e.removeButtonFromPlaceholderBlock(t)},e.handleArtistUnfollowEvent=function(t){e.removeButtonFromPlaceholderBlock(t)},e.removeButtonFromPlaceholderBlock=function(e){var t=e.querySelector(".Placeholder__button");t&&t.remove()},e}(),Je=i(52822),Ze=i(16539),et=i(66247),tt=i(73588),it=function(e){void 0===e&&(e={});var t=["MusicAuthorCover__followBtn"],i="audio_follow_artist_button",a="";e.isFollowed?(t.push("MusicAuthorCover__followBtn--followed"),i="audio_following_artist_button",a=(0,Je.default)({icon:(0,et.getDone24Icon)()})):a=(0,Je.default)({icon:(0,tt.getAdd24Icon)()});e.canFollow&&t.push("MusicAuthorCover__followBtn--canFollow");var n=e.isFollowed?"unfollow":"follow",o="event.preventDefault();"+(e.hint?"Tooltip.closeByHintId('"+e.hintId+"');":"")+"Curator."+n+"('"+e.curatorId+"', '"+e.hash+"', this)";return(0,s.default)({inner:[(0,l.getLang)(i),e.hint?(0,Ze.default)({inner:[e.hint],pos:"top_right",class:"MusicAuthorCover__followTooltip","tooltip-id":e.hintId,closeOnOverlayClick:!0}):null],class:t,onClick:o,use_native_onclick:!0,icon:a})};var at,nt=i(94374),st=function(){function e(){}return e.handleArtistFollowEvent=function(t){var i=t.querySelector(".MusicAuthorCover__followBtn");if(i instanceof HTMLElement&&i.parentNode instanceof HTMLElement){var a=i.dataset.id,n=i.dataset.hash,s=i.dataset.ref;(0,A.replace)(e.createFollowToggleButton("audio_following_artist_button",(0,Ge.Icon24Done)(),"Artist.unfollow('"+a+"', '"+s+"', '"+n+"', this)"),i),(0,nt.init)({type:1,text:(0,A.getLang)("audio_follow_artist_success_notification_title")+". "+(0,A.getLang)("audio_follow_artist_success_notification_text")})}},e.handleArtistUnfollowEvent=function(t){var i=t.querySelector(".MusicAuthorCover__followBtn");if(i instanceof HTMLElement&&i.parentNode instanceof HTMLElement){var a=i.dataset.id,n=i.dataset.hash,s=i.dataset.ref;(0,A.replace)(e.createFollowToggleButton("audio_follow_artist_button",(0,Ge.Icon24Add)(),"Artist.follow('"+a+"', '"+s+"', '"+n+"', this)"),i)}},e.handleCuratorFollowEvent=function(e){var t=e.querySelector(".MusicAuthorCover__followBtn");t instanceof HTMLElement&&t.parentNode instanceof HTMLElement&&(0,A.replace)(o.default.elem(it({curatorId:t.dataset.curatorId,hash:t.dataset.hash,isFollowed:!0,canFollow:!0})),t)},e.handleCuratorUnfollowEvent=function(e){var t=e.querySelector(".MusicAuthorCover__followBtn");t instanceof HTMLElement&&t.parentNode instanceof HTMLElement&&(0,A.replace)(o.default.elem(it({curatorId:t.dataset.curatorId,hash:t.dataset.hash,isFollowed:!1,canFollow:!0})),t)},e.createFollowToggleButton=function(e,t,i){return o.default.elem((0,s.default)({children:(0,A.getLang)(e),icon:t,className:"MusicAuthorCover__followBtn",onclick:i,use_native_onclick:!0}))},e}(),ot=function(){function e(){this.eventBus=new F,this.connectEvents()}return e.prototype.emit=function(e,t){this.eventBus.emit(e,t)},e.prototype.connectEvents=function(){var e=this;document.querySelectorAll(".AudioBlock").forEach((function(t){if(t.dataset.listenEvents&&t.dataset.blockId)try{var i=JSON.parse(t.dataset.listenEvents);Array.isArray(i)&&i.forEach((function(i){e.eventBus.subscribe(i,(function(a){return e.handleBlockUpdate(i,t,a)}))}))}catch(e){}}))},e.prototype.handleBlockUpdate=function(e,t,i){switch(e){case n.CatalogEvent.MusicOwnersFollow:this.handleMusicFollowEvent(t);break;case n.CatalogEvent.MusicOwnersUnfollow:this.handleMusicUnfollowEvent(t);break;case n.CatalogEvent.CuratorFollow:this.handleCuratorFollowEvent(t);break;case n.CatalogEvent.CuratorUnfollow:this.handleCuratorUnfollowEvent(t);break;case n.CatalogEvent.ArtistFollow:this.handleArtistFollowEvent(t);break;case n.CatalogEvent.ArtistUnfollow:this.handleArtistUnfollowEvent(t);case n.CatalogEvent.PlaceholderRemove:this.handlePlaceholderRemove(t,i)}},e.prototype.handleMusicFollowEvent=function(e){if("horizontal_buttons"===e.dataset.viewType)Ke.handleMusicFollowEvent(e)},e.prototype.handleMusicUnfollowEvent=function(e){switch(e.dataset.viewType){case"horizontal_buttons":Ke.handleMusicUnfollowEvent(e);break;case"placeholder":$e.handleMusicUnfollowEvent(e)}},e.prototype.handleArtistFollowEvent=function(e){if("banner"===e.dataset.viewType)st.handleArtistFollowEvent(e)},e.prototype.handleArtistUnfollowEvent=function(e){switch(e.dataset.viewType){case"banner":st.handleArtistUnfollowEvent(e);break;case"placeholder":$e.handleArtistUnfollowEvent(e)}},e.prototype.handlePlaceholderRemove=function(e,t){t&&e&&e.dataset.blockId===t&&e.remove()},e.prototype.handleCuratorFollowEvent=function(e){switch(e.dataset.viewType){case"horizontal_buttons":Ke.handleCuratorFollowEvent(e);break;case"banner":st.handleCuratorFollowEvent(e)}},e.prototype.handleCuratorUnfollowEvent=function(e){switch(e.dataset.viewType){case"horizontal_buttons":Ke.handleCuratorUnfollowEvent(e);break;case"banner":st.handleCuratorUnfollowEvent(e)}},e}(),rt=i(95283),lt=window&&window.navigator&&"mediaSession"in window.navigator&&"MediaMetadata"in window;var ut=function(){function e(e){this.adaptedPlayer=e,this.handlePlay=this.handlePlay.bind(this),this.handlePlaylistChange=this.handlePlaylistChange.bind(this),this.play=this.play.bind(this),this.pause=this.pause.bind(this),this.previousTrack=this.previousTrack.bind(this),this.nextTrack=this.nextTrack.bind(this),this.seekBackward=this.seekBackward.bind(this),this.seekForward=this.seekForward.bind(this)}return e.prototype.init=function(){lt&&(this.adaptedPlayer.subscribe(v.events.PLAY,this.handlePlay),this.adaptedPlayer.subscribe(v.events.PLAYLIST_CHANGED,this.handlePlaylistChange))},e.prototype.handlePlay=function(){if(lt){var e=this.adaptedPlayer.getCurrentAudio(),t=(0,j.asObject)(e);if(t){var i=(0,rt.decodeHTMLEntities)(t.title+(t.subTitle?" ("+t.subTitle+")":"")).replace(/<[^>]*>?/gm,""),a=(0,rt.decodeHTMLEntities)(t.performer||"").replace(/<[^>]*>?/gm,""),n=this.adaptedPlayer.getCurrentPlaylist(),s=n?(0,rt.decodeHTMLEntities)(n.getTitle&&n.getTitle()||"").replace(/<[^>]*>?/gm,""):"",o=t.coverUrl_p||t.coverUrl_s,r=o?[{sizes:"160x160",src:o}]:[];this.updateMediaSessionControls(),function(e){if(lt){(location.hostname+e.album).length>30&&(e.album=e.album.substring(0,30-location.hostname.length)+"…");var t=navigator.mediaSession.metadata;t?(t.title=e.title,t.artist=e.artist,t.album=e.album,t.artwork=e.artwork):navigator.mediaSession.metadata=new MediaMetadata(e)}}({title:i,artist:a,album:s,artwork:r})}}},e.prototype.handlePlaylistChange=function(){this.adaptedPlayer&&!this.adaptedPlayer.getCurrentAudio()&&lt&&((at=at||document.createElement("audio")).src=B,at.play().then((()=>{})).catch((()=>{})))},e.prototype.updateMediaSessionControls=function(){var e;if(lt)if(null===(e=this.adaptedPlayer.ads)||void 0===e?void 0:e.isPlaying())navigator.mediaSession.setActionHandler("play",this.play),navigator.mediaSession.setActionHandler("pause",this.pause),navigator.mediaSession.setActionHandler("seekbackward",null),navigator.mediaSession.setActionHandler("seekforward",null),navigator.mediaSession.setActionHandler("previoustrack",null),navigator.mediaSession.setActionHandler("nexttrack",null);else{navigator.mediaSession.setActionHandler("play",this.play),navigator.mediaSession.setActionHandler("pause",this.pause);var t=this.adaptedPlayer.getCurrentPlaylist(),i=this.adaptedPlayer.getCurrentPlaylistId(),a=this.adaptedPlayer.getCurrentAudio();if(this.adaptedPlayer.isPlaying()?(navigator.mediaSession.setActionHandler("seekbackward",this.seekBackward),navigator.mediaSession.setActionHandler("seekforward",this.seekForward)):(navigator.mediaSession.setActionHandler("seekbackward",null),navigator.mediaSession.setActionHandler("seekforward",null)),i&&(navigator.mediaSession.setActionHandler("nexttrack",this.nextTrack),navigator.mediaSession.setActionHandler("previoustrack",this.previousTrack)),t)if(t&&a&&!(0,g.isPodcast)(a)){var n=t.indexOfAudio(a),s=t.getAudioAt(n-1),o=t.getAudioAt(n+1);s?navigator.mediaSession.setActionHandler("previoustrack",this.previousTrack):navigator.mediaSession.setActionHandler("previoustrack",null),o?navigator.mediaSession.setActionHandler("nexttrack",this.nextTrack):navigator.mediaSession.setActionHandler("nexttrack",null)}else navigator.mediaSession.setActionHandler("previoustrack",null),navigator.mediaSession.setActionHandler("nexttrack",null)}},e.prototype.play=function(){this.adaptedPlayer.play(),(0,y.statlogsValueEvent)("global_media_controls","audio_player","play")},e.prototype.pause=function(){this.adaptedPlayer.pause(),(0,y.statlogsValueEvent)("global_media_controls","audio_player","pause")},e.prototype.previousTrack=function(){this.adaptedPlayer.prev(),(0,y.statlogsValueEvent)("global_media_controls","audio_player","previous_track")},e.prototype.nextTrack=function(){this.adaptedPlayer.next(),(0,y.statlogsValueEvent)("global_media_controls","audio_player","next_track")},e.prototype.seekBackward=function(){var e=(0,j.asObject)(this.adaptedPlayer.getCurrentAudio()),t=e.getCurrentProgress()*e.duration(),i=Math.max(0,(t-10)/e.duration());i>0?this.adaptedPlayer.seek(i):this.adaptedPlayer.prev(),(0,y.statlogsValueEvent)("global_media_controls","audio_player","seek_backward")},e.prototype.seekForward=function(){var e=(0,j.asObject)(this.adaptedPlayer.getCurrentAudio()),t=(this.adaptedPlayer.getCurrentProgress()||0)*e.duration(),i=Math.min(1,(t+10)/e.duration());i<1?this.adaptedPlayer.seek(i):this.adaptedPlayer.next(),(0,y.statlogsValueEvent)("global_media_controls","audio_player","seek_forward")},e}(),dt=function(){function e(e){this.player=e,this.ads=this.player.ads}return e.prototype.play=function(){return this.player.play()},e.prototype.pause=function(){return this.player.pause()},e.prototype.isPlaying=function(){return this.player.isPlaying()},e.prototype.next=function(){return this.player.next()},e.prototype.prev=function(){return this.player.prev()},e.prototype.seek=function(e){return this.player.seek(e)},e.prototype.getCurrentPlaylist=function(){return null},e.prototype.getCurrentPlaylistId=function(){return this.player.getCurrentPlaylistId()},e.prototype.subscribe=function(e,t){return this.player.subscribe(e,t)},e.prototype.unsubscribe=function(e,t){return this.player.unsubscribe(e,t)},e.prototype.getCurrentAudio=function(){return this.player.getCurrent()},e.prototype.getCurrentProgress=function(){return this.player.getCurrentProgress()},e}(),ct="ad_placeholder",ht="ad_mode",{audio:_t}=window,pt=function(){if(!HTMLAudioElement)return{init:()=>{},initAudio:()=>{}};var e=!1,t="1"==lsGet("audio_time_left"),i={},n=!1,s=!1,u=!1,d=[],c=null,h=[],p=null;window.onDOMReady((()=>{window.playerAdapter=new Ue(_t),new Le(window.playerAdapter),h=We.initBannerBlocks(),p=new ot,xe.Section.onShow()})),window.page.onChange((()=>{["audio","curator"].includes(cur.module)&&(h&&h.forEach((e=>e.destroy())),h=We.initBannerBlocks(),p=new ot,xe.Section.onShow())}));var f=new dt(_t);function g(e){if(e){$$("#lm_player").forEach((e=>{show(e)})),$$("#lm_audio").forEach((t=>{t&&(t.querySelector(".ai_artist").innerHTML=e.performer,t.querySelector(".ai_title").innerHTML=e.title,t.querySelector(".ai_play").style.backgroundImage=e.coverUrl_p?"url("+e.coverUrl_p+")":""),_t.isAdsPlaying()&&Q(e,!0)}));var t=ee(e.fullId);t&&each(t,((t,i)=>{_t.isAdsPlaying()?(G(e,!0),(0,A.addClass)("ai_playing",i)):(R(i,0),N(i,0),U(i,H(0,_t.duration()))),B(i,_t.volume()),(0,A.addClass)("ai_current",i)}))}else $$("#lm_player").forEach((e=>{hide(e)}))}function y(e){var{fullId:t,duration:a}=e;$$("#lm_audio").forEach((e=>{removeClass("ai_playing",e)}));var n=ee(t);n&&(each(n,((e,t)=>{U(t,x(a)),removeClass("ai_playing",t),removeClass("ai_current",t)})),i[t]&&delete i[t],_t.isAdsPlaying()&&G(e,!1))}function m(e,t,a,n){var s=ee(e);if(s.length){var o=t*(a||0);each(s,((e,i)=>{b||N(i,t),U(i,pt.getFormatedTime(o,a))})),o>1&&(i[e]=1)}}function E(e,t){window.audio.playNothing(),ajax.post("/audio",{act:"block_playlist",block_id:e},{onDone:function(i){if(i){var a=i.map((e=>(0,j.asObject)(e)));_t.playlist(a),_t.setPlaylistId(e),t&&t(a)}}})}function I(e,t,i){window.audio.playNothing();var[a,n,s]=e.split("_");ajax.post("/audio",{act:"audio_playlist",oid:a,playlist_id:n,access_hash:s,_ajax:1,ref:t},{onDone:function(e,t,a){if(a){var n=a.map((e=>(0,j.asObject)(e)));i&&i(n)}}})}function P(e,t){void 0===t&&(t=!1);var i=te(e),a=(0,A.gpeByClass)("audios_list",i)||(0,A.gpeByClass)("AudioBlock",i),n=geByClass("audio_item",a),s=[],o=!1;each(n,((t,i)=>{var a=JSON.parse(domData(i,"audio"));if(a){var n=(0,j.asObject)(a);s.push(n),n.fullId===e&&(o=!0)}})),_t.playlist(s,{q:attr(a,"data-query")}),t&&o&&o&&_t.play(e)}new ut(f).init(),_t.subscribe(v.events.PLAY,(function(e){var t=_t.getCurrent();t&&_t.playing()&&!_t.isAdsPlaying()&&ajax.post("/audio",{act:"start_playback",audio_id:t.id,owner_id:t.ownerId,hash:t.actionHash,uuid:_t.getDeviceId()});e,$$("#lm_audio").forEach((e=>{(0,A.addClass)("ai_playing",e)}));var i=ee(e);if(!i)return;each(i,((e,t)=>{(0,A.addClass)("ai_playing",t),(0,A.addClass)("ai_current",t)})),d[d.length-1]!==e&&d.push(e);u?u=!1:(s=n,n=!1,pt.onPlay(e));X()})),_t.subscribe(v.events.PLAY_REQUESTED,(function(e){z(e)})),_t.subscribe(v.events.PAUSE,(function(e){$$("#lm_audio").forEach((e=>{removeClass("ai_playing",e)})),X();var t=ee(e);if(!t.length)return;each(t,((e,t)=>{removeClass("ai_playing",t),(0,A.addClass)("ai_current",t)})),u||(pt.onPause(e),X())})),_t.subscribe(v.events.SELECT,g),_t.subscribe(v.events.DESELECT,y),_t.subscribe(v.events.PROGRESS,m),_t.subscribe(v.events.SEEK,m),_t.subscribe(v.events.AD_STARTED,(e=>{G(e,!0),Q(e,!0)})),_t.subscribe(v.events.AD_COMPLETED,(e=>{G(e,!1),Q(e,!1),m(e.id,0,0)})),_t.subscribe(v.events.NOT_FOUND_PLAYLIST,P),_t.subscribe(v.events.EMPTY_PLAYLIST,P),_t.subscribe(v.events.ENDED,(e=>{var t=geBySel('.audio_item[data-id="'+e+'"]');t&&(each(t,((e,t)=>{N(t,1)})),n=!0,window.vk&&!window.vk.id&&(0,w.partConfigEnabled)("audio_unauth_preview_box")&&(n=!1,window.audio.pause(),ze.Unauthorized.showMoreBox(null,0,He.UnauthorizedSourceType.AUDIO)),pt.onEnded(e))})),_t.subscribe(v.events.VOLUME,((e,t)=>{var i=geBySel('.audio_item[data-id="'+e+'"]');i&&(each(i,((e,i)=>{B(i,t)})),pt.onVolume(e,t))}));var b=null,C=null,S=!1,k=!1,L=!1;function M(e){if(b){L||(addEvent(document,T.isTouch?"touchmove":"mousemove",M),addEvent(document,T.isTouch?"touchend touchcancel":"mouseup",D),L=!0);var t=(0,A.gpeByClass)("audio_item",b),i=O(b,e);e&&cancelEvent(e);var a=ee(attr(t,"data-id"));each(a,((e,t)=>{S&&N(t,i),k&&(B(t,i),_t.volume(i))})),C=i}}function D(e){if(b){L=!1,removeEvent(document,T.isTouch?"touchmove":"mousemove",M),removeEvent(document,T.isTouch?"touchend touchcancel":"mouseup",D);var t=(0,A.gpeByClass)("audio_item",b),i=O(b,e)||C;e&&cancelEvent(e);var a=geBySel('.audio_item[data-id="'+attr(t,"data-id")+'"]');each(a,((e,a)=>{S&&(N(a,i),_t.setPosition(i,!0)),k&&B(t,i)})),S&&(u=_t.playing(),pt.onSeek(i)),b=C=null,S=k=!1}}function O(e,t){var i=(0,A.gpeByClass)("Slider__scroll",e),a=hasClass("touch",window.bodyNode)?10:8,n=(t.pageX||t.touches&&t.touches[0]&&t.touches[0].pageX||0)-(i?e.getBoundingClientRect().left:getX(e))-a/2,s=e.offsetWidth-a;return s?Math.max(0,Math.min(n/s,1)):0}function U(e,t){if(e){var i=geByClass1("ai_dur",e);val(i,t)}}function R(e,t){if(e){var i=geByClass1("aic_progress_wrap",e),a=geByClass1("aic_load_line",i);a&&(a.style.width=100*Math.max(0,Math.min(t,1))+"%")}}function N(e,t){if(e){var i=geByClass1("aic_progress_wrap",e),a=geByClass1("aic_progress_line",i);a&&(a.style.width=100*t+"%")}}function B(e,t){if(e){var i=geByClass1("aic_volume_wrap",e),a=geByClass1("aic_progress_line",i);a&&(a.style.width=100*t+"%")}}function x(e){var t,i,a,n=e<0;return t=(i=(e=Math.round(n?-e:e))%60)<10?"0"+i:i,t=(a=(e=Math.floor(e/60))%60)+":"+t,(e=Math.floor(e/60))>0&&(a<10&&(t="0"+t),t=e+":"+t),n&&(t="-"+t),t}function H(e,i){return x(t&&i?e-i:e)}function F(e){var{cur:t}=window;t.deletedAudios||(t.deletedAudios={}),t.deletedAudios[e]=!0}function V(e){var{cur:t}=window;t.deletedAudios&&delete t.deletedAudios[e]}function Y(e,t,i){void 0===i&&(i=null),t?function(e){var{cur:t}=window;t.addedAudios||(t.addedAudios={}),t.addedAudios[e]=!0}(e):function(e){var{cur:t}=window;t.addedAudios&&delete t.addedAudios[e]}(e);var a=geBySel('.audio_item[data-id="'+e+'"]');each(a,((e,i)=>{toggleClass("ai_added",i,t),val(geByClass1("ai_add",i),t?lang.global_delete_audio:lang.global_add_to_audio)}));var n=geBySel1('body > [id="ai_menu_'+e+'"]'),s=geByClass1("ai_add",n);val(s,t?lang.global_delete_audio:lang.global_add_to_audio),K[e]=t,i&&((i.querySelector(".Btn__text")||i).innerText=t?lang.global_delete_audio:lang.global_add_to_audio),ActionMenu.update()}function q(e,t,i){void 0===i&&(i=null),t?F(e):V(e);var a=geBySel('.audio_item[data-id="'+e+'"]');each(a,((e,i)=>{toggleClass("ai_deleted",i,t),val(geByClass1("ai_del",i),t?lang.global_add_to_audio:lang.global_delete_audio)}));var n=geBySel1('body > [id="ai_menu_'+e+'"]'),s=geByClass1("ai_del",n);val(s,t?lang.global_add_to_audio:lang.global_delete_audio),K[e]=!t,i&&((i.querySelector(".Btn__text")||i).innerText=t?lang.global_add_to_audio:lang.global_delete_audio),ActionMenu.update()}function X(){var e=window.audio.getCurrentId(),t=ee(e),i=[],a=window.audio.playing();a&&e&&t.length&&t.forEach((e=>{var t=(0,A.gpeByClass)("audios_list",e)||(0,A.gpeByClass)("mcont",e);i.push(t)})),each(geByClass("_AudioPlayStatus"),((e,t)=>{var i=a&&t.dataset.playlistId===_t.getCurrentPlaylistId();toggleClass(t,"playing",i)}))}function W(e,t,i){var{isArticleWebView:a}=window;if(a)return Article.audioPlay(_t.getCurrentId(),_t.playlist()),cancelEvent(e),!1;var{lang:n}=window,s=e.target.closest(".AudioPlaylistRoot");if(_t.support){var o=te(t);if(o&&hasClass("ai_deleted",o)&&!hasClass("ai_current",o))return!0;if(i&&t!==_t.getCurrentId()||ie(t)!==_t.getCurrentPlaylistId()){if(P(t,!0),s&&s.dataset.hasOwnProperty("hasMore")){var r=(0,A.gpeByClass)("AudioBlock",e.target),l=r?r.dataset.blockId:"";I(s.dataset.playlistId,l,(e=>{_t.addToPlaylist(e),delete s.dataset.hasMore}))}}else{var u=s&&s.dataset.playlistId;u&&_t.setPlaylistId(u),_t.operate(t)}}else alert(n.mobile_audio_player_not_support);return cancelEvent(e),!1}function z(e,t,i){void 0===t&&(t=null),void 0===i&&(i=null);var a=ee(e);_t.playing()?(each(a,((e,t)=>{(0,A.addClass)("ai_playing",t)})),$$("#lm_audio").forEach((e=>{(0,A.addClass)("ai_playing",e)}))):(each(a,((e,t)=>{removeClass("ai_playing",t)})),$$("#lm_audio").forEach((e=>{removeClass("ai_playing",e)}))),null!==t&&null!==i&&each(a,((e,a)=>{R(a,t/i),(0,A.addClass)("ai_current",a)}))}function G(e,t){var i=te(e.fullId);toggleClass(ht,i,t);var a=geByClass1("ai_title",i);val(a,t?(0,l.getLang)("global_audio_ad"):e.title),toggleClass(ct,a,t)}function Q(e,t){geBySel(".audio_item.al_player").forEach((i=>{if(i){var a=geByClass1("ai_title",i);val(a,t?(0,l.getLang)("global_audio_ad"):e.title),toggleClass(ct,a,t),toggleClass(ht,i,t),toggle(geByClass1("ai_artist"),!t)}}))}var K={},$={};return page.onChange((function(){K={},$={}})),{init:function(t){e||(e=!0,onDOMReady((function(){window.nav&&window.audio&&window.audioplayer&&"#player"==nav.hash&&_t.playlist().length&&pt.openPlayer(geByClass1("AudioPlayerMini"),!0)})))},initAudio:function(){each(geByClass("ai_current"),(function(e,t){y(t=function(e){if(!(e=ge(e))||!e.dataset.audio)return null;var t=null;try{t=JSON.parse(e.dataset.audio)}catch(e){return null}return(0,j.asObject)(t)}(t))}));var e=_t.loaded(),t=_t.getPosition(),i=_t.duration(),a=i?t/i:0;z(_t.getCurrentId(),e,i),g(_t.getCurrent()),m(_t.getCurrentId(),a,i),setTimeout((()=>{X()}),1)},getDOMFromAudio:function(e,t,i,a){if(!Object.keys(e).length)return'<div class="audio_item audio_item_disabled"></div>';var n=(0,j.asObject)(e);if(!n)return"";var s=(0,_.htsc)(n.ownerId+"_"+n.id),r=n.coverUrl_p||n.coverUrl_s,l=e,u=[];if(function(e){var{cur:t}=window;return!!t.deletedAudios&&t.deletedAudios[e]}(s)){if(i)return"";u.push(" ai_deleted")}(function(e){var{cur:t}=window;return!!t.addedAudios&&t.addedAudios[e]})(s)&&u.push("ai_added"),s===_t.getCurrentId()&&(_t.playing()&&u.push("ai_playing"),u.push("ai_current"));var d=!!vk.id&&(!n.isClaimed||n.canDelete);vk.id||u.push("ai_no_menu");var c=new Ne.default({is_playlist_forced:t,is_disabled:n.isClaimed,audio_id:s,is_authenticated:!!vk.id,login_redirect_url:"",is_explicit:n.isExplicit,can_add:n.canAdd,can_del:n.canDelete,serialized:JSON.stringify(l),classes:u,has_cover:a,cover_style:r?"background-image: url("+r+")":"",has_actions_menu:d,position:n.chartInfo?n.chartInfo.position:"",duration:n.duration,is_mobile:T.isTouch,_duration_title:x(n.duration),title:n.title,subtitle:n.subtitle,artist:n.performer,url:n.url});return o.default.html(c)},morePopup:function(e,t,i,a){if(void 0===t&&(t=null),void 0===i&&(i=null),void 0===a&&(a=null),null===t){var n=_t.getCurrent()||{};t=n.fullId,i=n.accessKey,a=n.canDelete,$[t]=n}var s="";s=void 0!==K[t]?K[t]?(0,l.getLang)("global_delete_audio"):(0,l.getLang)("global_add_to_audio"):a?(0,l.getLang)("global_delete_audio"):(0,l.getLang)("global_add_to_audio"),r.default.open(o.default.elem((0,r.default)({on_overlay_click:["return ContextMenu.close","this"],class:"ContextMenu",close:!0,onClose:["return ContextMenu.close","this"],items:[{tag:"ul",class:"ContextMenu__list",inner:[!a&&{tag:"li",class:"ContextMenu__listItem",inner:[{tag:"a",class:"ContextMenu__listLink",href:"#",inner:s,onclick:"return audioplayer.add('"+t+"', '"+i+"', event, this);"}]},a&&{tag:"li",class:"ContextMenu__listItem",inner:[{tag:"a",class:"ContextMenu__listLink",href:"#",inner:s,onclick:"return audioplayer.del('"+t+"', event, this);"}]}]}]})),!0),e&&cancelEvent(e)},add:function(e,t,i,a){void 0===t&&(t=null),void 0===a&&(a=null);var n=te(e);if(!hasClass("ai_ajax",n)){var s=n?(0,j.asObject)(JSON.parse(n.dataset.audio)):$[e]||{};$[e]||($[e]=(0,re.default)({},s));var o=!1;n?(o=hasClass("ai_added",n),$[e].deleteid=attr(n,"data-deleteid"),$[e].deleteHash=attr(n,"data-delete-hash")):void 0!==K[e]&&(o=K[e]),s.deleteid=s.deleteid||$[e].deleteid,s.deleteHash=s.deleteHash||$[e].deleteHash,s.restoreHash=s.restoreHash||$[e].restoreHash,Y(e,!o,a),(0,A.addClass)("ai_ajax",n),pt.onAdd(),a&&(a.disabled=!0),ajax.post("/audio",{_ajax:1,act:o?"delete":"add",audio:o?s.deleteid:s.fullId,hash:o?s.deleteHash:s.addHash,access_key:t,track_code:s.trackCode,source_playlist_id:ie(s.fullId)},{redirectToLoginPage:!0,onDone:function(t,i){removeClass("ai_ajax",n),t?($[e].deleteid=t,$[e].deleteHash=i,attr(n,"data-deleteid",t),attr(n,"data-delete-hash",i)):Y(e,o,a),a&&(a.disabled=!1)},onFail:function(){removeClass("ai_ajax",n),Y(e,o,a);var i=Array.prototype.slice.call(arguments),r=i.shift();if(2===r)nav.go("/audio?act=add&audio="+e+"&hash="+(o?s.deleteHash:s.addHash)+"&access_key="+t);a&&(a.disabled=!1)}}),i&&cancelEvent(i)}},del:function(e,t,i){void 0===i&&(i=null);var a=te(e),n=!1;a?n=hasClass("ai_deleted",a):void 0!==K[e]&&(n=!K[e]),q(e,!n,i);var s=a?(0,j.asObject)(JSON.parse(a.dataset.audio)):$[e]||{};$[e]||($[e]=(0,re.default)({},s)),n?V(e):F(e),pt.onDel(),i&&(i.disabled=!0),s.deleteid=s.deleteid||$[e].deleteid,s.deleteHash=s.deleteHash||$[e].deleteHash,s.restoreHash=s.restoreHash||$[e].restoreHash,ajax.post("/audio",{_ajax:1,act:n?"restore":"delete",audio:e,playlist_id:ie(e),hash:n?s.restoreHash:s.deleteHash},{redirectToLoginPage:!0,onDone:function(t){t||q(e,n,i),i&&(i.disabled=!1)},onFail:function(){q(e,n,i);var t=Array.prototype.slice.call(arguments),a=t.shift();if(2===a)nav.go("/audio?act="+(n?"restore":"delete")+"&audio="+e+"&hash="+(n?s.restoreHash:s.deleteHash));i&&(i.disabled=!1)}}),t&&cancelEvent(t)},playPause:W,getFormatedTime:H,switchTimeFormat:function(e,i){var a=(0,A.gpeByClass)("audio_item",e);return!(hasClass("ai_current",a)&&!hasClass("ai_select",a))||(t=!t,lsSet("audio_time_left",t?"1":"0"),U(te(_t.getCurrentId()),H(_t.getPosition(),_t.duration())),i&&cancelEvent(i),!1)},setPosition:function(e,t){b||_t.isAdsPlaying()||(b=e,S=!0,M(t))},setVolume:function(e,t){b||(b=e,k=!0,M(t))},openPlayer:function(e,t){var{audio:i}=window,a=nav.path,n=i.getCurrentPlaylistId(),s=nav.params;n&&!s.includes("playlist_id")&&(s=(s?s+"&":"")+"playlist_id="+n);var o="#player",r=a+(s?"?":"")+s+o;return nav.al_go(r,null,{local:!0,target:e,nav:{push:r,path:a,params:s,hash:o},no_push:t})},getCurrentElem:()=>(0,le.$)(".ai_current"),playFirst:function(e,t){e&&cancelEvent(e);var i=_t.getCurrent(),a=(0,A.gpeByClass)("_audioPlaylist",t),n=i?i.fullId:null;if(!n||!geByClass1("ai_current",a)){var s=(a||ge("mcont")).$(".audio_item");n=s&&s.getAttribute("data-id")}n&&W(e,n)},playPlaylist:function(e,t,i){if(cancelEvent(i),_t.getCurrentPlaylistId()===e)_t.operate();else{var a=_t.getCurrentPlaylistId();I(e,t,(t=>{if(a===_t.getCurrentPlaylistId()&&(_t.playlist(t),_t.setPlaylistId(e),t.length)){var i=t[0].fullId;_t.select(i).then((()=>{_t.play(i)}))}}))}},hasArticleWebViewClientAudioSupport:function(){return window.clientWebviewAudioSupport},getPlaybackQueue:()=>d,isAutoPlayed:()=>s,playBlock:function(e,t,i){t.preventDefault(),_t.getCurrentPlaylistId()!==e?E(e,(t=>{if(t.length){var a=t[0].fullId;_t.select(a).then((()=>{_t.play(a),_t.setPlaylistId(e),i.classList.add("playing"),i.dataset.playlistId=e}))}})):_t.operate()},playShuffledBlock:function(e,t){e.preventDefault(),E(t.dataset.blockId,(e=>{if(e.length){var t=e[0].fullId;window.audio.play(t)}}))},openModal:function(e,t){var i=t.parentElement.querySelector(".Popup");return r.default.open(i,!0),c=(0,Be.expandPopup)(t),cancelEvent(e),!1},closeModal:function(e){r.default.close(e),c&&c()},emitCatalogEvent:function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),a=1;a<t;a++)i[a-1]=arguments[a];return p&&p.emit(e,...i)},onAdd:(0,a.default)(),onDel:(0,a.default)(),onPlay:(0,a.default)(),onPause:(0,a.default)(),onProgress:(0,a.default)(),onVolume:(0,a.default)(),onSeek:(0,a.default)(),onPlaylistChanged:(0,a.default)(),onEnded:(0,a.default)(),sliderMove:M,sliderUp:D}}();window.ajax.enabled&&window.onDOMReady((function(){null==pt||pt.initAudio()})),window.audioplayer=pt,window.Section=xe.Section;var ft={onStart:window.Wall.onStart,onDone:function(e,t){var i=window.cur;d.default.tAlProcess=(new Date).getTime();var a=(0,A.geByClass1)("audios_block",(0,A.geByClass1)("audios","mcont")),n=(0,A.ge)("show_more_wrap"),s=window.cdf(t),o=window.cdf(e);a&&a.appendChild(o),(0,A.before)(s,n),(0,A.remove)(n),d.default.prepare_click("mcont"),d.default.tAlModule=i.module,d.default.tAlRender=(new Date).getTime()}},vt={onStart:window.Wall.onStart,onDone:function(e,t){var i=window.cur,a=(0,O.__read)(e,2),n=a[0],s=a[1],o=(0,A.ge)("show_more_wrap");d.default.tAlProcess=Date.now(),xe.Section.handlePagination(n,t),(0,A.remove)(o);var r=xe.Section.getSection(t.name);r&&r.appendChild(window.cdf(s)),d.default.prepare_click("mcont"),(0,A.onBodyScrollForce)(100),d.default.tAlModule=i.module,d.default.tAlRender=Date.now()}};window.AudioSection=vt,window.Audios=ft,window.AudioSpecialForYou={selector:".AudioSpecialForYou",setPlaying:function(e){var t=(0,le.$)(gt.special);t&&t.classList.toggle(yt,e)}};var gt={special:window.AudioSpecialForYou.selector},yt="AudioSpecialForYou_playing";var mt=(0,A.need)("page"),Et=(0,A.need)("audio"),At=(0,A.need)("onDOMReady"),wt=(0,A.need)("audioplayer"),It=(0,A.need)("AudioSpecialForYou");function Pt(){Ct(),Et.subscribe([Et.events.INIT,Et.events.SELECT,Et.events.PAUSE],Ct),mt.onChange(Ct)}function bt(e){var{$btn:t}=e;St()?wt.playPause():wt.playFirst(null,t),wt.onPlay(Ct),wt.onPause(Ct)}function Ct(){It.setPlaying(Et.playing()&&St())}window.uAudioBlock={},At(Pt),window.uAudioBlock._onSpecialPlayAllClick=bt;var Tt=null;function St(){var e=Et.getCurrentPlaylistId();if(!Tt){var t=document.querySelector(window.AudioSpecialForYou.selector);t&&(Tt=t.querySelector(".AudioPlaylistRoot").dataset.playlistId)}return!!Tt&&e===Tt}var kt,Lt=i(35207),Mt=(kt="audioPlaylist__add_added",{_onMorePopupClose:function(e){return this.expand&&this.expand(),r.default.close(e)},morePopup:function(e,t){var i=parseInt((0,A.attr)(t,"data-owner_id"),10),a=parseInt((0,A.attr)(t,"data-playlist_id"),10),n=(0,A.attr)(t,"data-publish_href"),s="true"===(0,A.attr)(t,"data-is_followed"),u=(0,A.attr)(t,"data-follow_hash"),d=(0,A.attr)(t,"data-can_share"),c=u?"/audio?act=follow_playlist&playlist_owner_id="+i+"&playlist_id="+a+"&hash="+u:"";r.default.open(o.default.elem((0,r.default)({id:"more-"+i+"-"+a,on_overlay_click:["return AudioPlaylist._onMorePopupClose","this"],close:!0,onClose:["return AudioPlaylist._onMorePopupClose","this"],items:[u&&i!==window.vk.id&&(0,r.ModalMenuBtn)({url:c,class:s?" audioPlaylist__add_added":"",inner:[{inner:s?(0,l.getLang)("mobile_playlist_unfollow"):(0,l.getLang)("mobile_playlist_follow"),tag:"span",class:"audioPlaylistSnippet__buttonText"}],attrs:{"data-playlist_owner_id":i,"data-playlist_id":a,"data-hash":u,"data-follow_text":(0,l.getLang)("mobile_playlist_follow"),"data-unfollow_text":(0,l.getLang)("mobile_playlist_unfollow")},onclick:"return AudioPlaylist.followPlaylist(event, this);"}),d&&(0,r.ModalMenuBtn)({url:n,inner:(0,l.getLang)("mobile_like_publish_title"),onclick:'return AudioPlaylist._onMorePopupClose(this) || nav.go("'+n+'");'})]})),!0),this.expand=(0,Be.expandPopup)(t)},playPause:function(e,t){(0,A.preventEvent)(e);var i=(0,A.gpeByClass)("_audioSnippet",t),a=(0,A.geByClass1)("audio_item",i);window.audioplayer.playPause(e,(0,A.attr)(a,"data-id")),(0,A.toggleClass)("audioSnippet__playpause_paused",t)},followPlaylist:function(e,t){(0,A.preventEvent)(e);var i=(0,A.attr)(t,"data-playlist_owner_id"),a=(0,A.attr)(t,"data-playlist_id"),n=(0,A.attr)(t,"data-hash"),s=(0,A.geByClass1)("_audioPlaylistsPage__item"+i+"_"+a),o=t.querySelector(".audioPlaylistSnippet__buttonText"),r=(0,A.hasClass)(kt,t);o&&(o.innerText=r?(0,A.attr)(t,"data-follow_text"):(0,A.attr)(t,"data-unfollow_text")),(0,A.toggleClass)("audioPlaylistsPage__item_removed",s,r),(0,A.toggleClass)(kt,t),function(e){d.default.post("/audio",{_ajax:1,act:"follow_playlist",playlist_owner_id:(0,A.attr)(e,"data-playlist_owner_id"),playlist_id:(0,A.attr)(e,"data-playlist_id"),hash:(0,A.attr)(e,"data-hash")},{redirectToLoginPage:!0})}(t);for(var l=document.querySelectorAll('button[data-owner_id="'+i+'"][data-playlist_id="'+a+'"][data-follow_hash="'+n+'"]'),u=0;u<l.length;u++)(0,A.attr)(l[u],"data-is_followed",r?"false":"true")},tplSearchBlockItem:function(e){return'<div class="audioPlaylists__item">\n              <a href="'+e.href+'" class="audioPlaylists__itemLink al_playlist">'+e.title+'</a>\n              <span class="audioPlaylists__itemCover" style="'+e.thumb_style+'">'+e.grid_covers+'</span>\n              <span class="audioPlaylists__itemTitle">'+e.title+'</span>\n              <span class="audioPlaylists__itemAuthor">'+e.author_name+'</span>\n              <span class="audioPlaylists__itemStats">'+e.short_stats+"</span>\n            </div>"},tplSearchBlock:function(e,t,i,a){return e?'<div class="audioPlaylists">\n                <div class="audioPlaylists__header">\n                  <div class="audioPlaylists__cell">\n                    <div class="audioPlaylists__title">'+i+'</div>\n                  </div>\n                  <div class="audioPlaylists__cell">'+a+'</div>\n                </div>\n                <div class="audioPlaylists__body _preventMenuOpen">\n                  <div class="audioPlaylists__items">\n                    '+e+"\n                  </div>\n                </div>\n              </div>":""},tplSearchListItem:function(e,t){void 0===t&&(t=!1);var i='<div class="audioPlaylistsPage__cell audioPlaylistsPage__cell_actions">\n                <div class="audioPlaylistsPage__menu ai_menu_wrap">\n                  <button class="ai_menu_toggle_button" onclick="AudioPlaylist.morePopup(event, this);" data-owner_id="'+e.owner_id+'" data-playlist_id="'+e.id+'" data-publish_href="'+e.publish_href+'" data-is_followed="'+e.is_followed+'" data-follow_hash="'+e.follow_hash+'" aria-label="'+(0,l.getLang)("mobile_more")+'" aria-haspopup="true" aria-expanded="false" aria-controls="more-'+e.owner_id+"-"+e.id+'"></button>\n                </div>\n             </div>\n             '+e.actions;t&&(i='<div class="audioPlaylistsPage__cell audioPlaylistsPage__cell_actions">\n                   <div class="audioPlaylistsPage__menu ai_menu_wrap">\n                     <button class="ai_menu_toggle_button"></button>\n                   </div>\n                 </div>');var a=e.grid_covers;return a||e.thumb_style||(a=o.default.html({class:"audioPlaylistsPage__coverPlaceholder",inner:(0,Je.default)((0,Lt.getPlaylistOutline36Icon)())})),'<div class="audioPlaylistsPage__item _audioPlaylistsPage__item'+e.owner_id+"_"+e.id+'">\n              <div class="audioPlaylistsPage__cell audioPlaylistsPage__cell_link">\n                <a href="'+e.href+'" class="audioPlaylistsPage__itemLink">'+e.title+'</a>\n                <span class="audioPlaylistsPage__container">\n                  <span class="audioPlaylistsPage__cell audioPlaylistsPage__cell_cover">\n                    <span class="audioPlaylistsPage__cover" style="'+e.thumb_style+'">'+a+'</span>\n                  </span>\n                  <span class="audioPlaylistsPage__cell audioPlaylistsPage__cell_desc">\n                    <span class="audioPlaylistsPage__title">'+e.title+'</span>\n                    <span class="audioPlaylistsPage__author">'+e.author_name+'</span>\n                    <span class="audioPlaylistsPage__stats">'+e.short_stats+"</span>\n                  </span>\n                </span>\n              </div>\n              "+i+"\n            </div>"},tplSearchListNull:function(e){return'<div class="audioPlaylistsPage__notFound">\n              '+e+"\n            </div>"},tplPlaylistsPage:function(e,t){return void 0===t&&(t=""),'<div class="PageBlock">\n              <div class="audioPlaylistsPage">\n                <div class="audioPage__search">\n                  '+t+'\n                </div>\n                <div class="audioPlaylistsPage__list _si_container" id="au_search_playlist_items">\n                  '+e+"\n                </div>\n              </div>\n            </div>"},tplPlayerSearch:function(e,t){void 0===e&&(e=""),void 0===t&&(t=!1),(0,A.escapeAttr)(e),(0,l.getLang)("mobile_audio_search_btn");var i=function(e,t){return void 0===e&&(e=""),void 0===t&&(t=""),'<div class="audioPage__search">\n              <div class="hp_block">\n                '+e+'\n                <div class="qsearch">\n                  <table class="row_table">\n                    <tr>\n                      <td class="row_table_main_column">\n                        <div class="qs_field_wrap">\n                          <div class="iwrap">\n                            <input id="au_search_field" type="text" class="textfield qs_textfield" name="q" placeholder="'+(0,l.getLang)("mobile_audio_search_placeholder_simple")+'">\n                          </div>\n                        </div>\n                      </td>\n                      <td class="row_table_last_column">\n                        '+t+"\n                      </td>\n                    </tr>\n                  </table>\n                </div>\n              </div>\n            </div>"};return t?i():((e,t,i)=>'<form action="/audio" class="qsearch" onsubmit="return cur.au_search.go(event);">'+e(t,i)+"</form>")(i)},copyValue:function(e,t){var i=(0,A.val)(e),a=(0,A.ge)(t+"_field");(0,A.val)(a,i),cur&&cur[t]&&cur[t].go();var n=(0,A.geBySel1)(".audioPage__tabs .tab_item_cur");n&&(0,A.toggleClass)("tab_item_cur_noactive",n,i)}});window.AudioPlaylist=Mt;var Dt="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAA=",Ot='audio/mpeg; codecs="mp3"';class Ut{static isSupported(e){var t=document.createElement("audio");return!!t.canPlayType&&(!((e=e||Ot)!==Ot||!(f.browser.safari||f.browser.safari_mobile||f.browser.ios)||!f.browser.version.toString().startsWith("14"))||!!t.canPlayType(e).replace(/no/,""))}constructor(e){this.opts=e||{},this._trackOptions={},this._audioNodes=[],this._currentAudioEl=this._createAudioNode(),this._prefetchAudioEl=this._createAudioNode()}get type(){return"html5"}get loaded(){return!0}destroy(){}getPlayedTime(){for(var e=this._currentAudioEl.played,t=0,i=0;i<e.length;i++)t+=e.end(i)-e.start(i);return t}_setAudioNodeUrl(e,t){window.data&&window.data(e,"setUrlTimesetUrlTime",t==Dt?0:Date.now()),e.src=t}_createAudioNode(e){var t=new Audio,i=this;return this.opts.onBufferUpdate&&addEvent(t,"progress",(function(){i._currentAudioEl==t&&i.opts.onBufferUpdate(i.getCurrentBuffered());var e=t.buffered;1==e.length&&0==e.start(0)&&e.end(0)==t.duration&&(t._fullyLoaded=!0)})),addEvent(t,"stalled",(function(){i._currentAudioEl==t&&i._isInvalidDuration()&&i._currentAudioEl.currentTime>=i.duration-1&&i._currentAudioEl.dispatchEvent(new Event("ended"))})),this.opts.onProgressUpdate&&addEvent(t,"timeupdate",(function(){i._currentAudioEl==t&&i.opts.onProgressUpdate(i.getCurrentProgress())})),this.opts.onEnd&&addEvent(t,"ended",(function(){i._currentAudioEl==t&&i.opts.onEnd()})),this.opts.onSeeked&&addEvent(t,"seeked",(function(){i._currentAudioEl==t&&i.opts.onSeeked()})),this.opts.onSeek&&addEvent(t,"seeking",(function(){i._currentAudioEl==t&&i.opts.onSeek()})),addEvent(t,"error",(function(){i._prefetchAudioEl==t?i._prefetchAudioEl=i._createAudioNode():i._currentAudioEl==t&&i.opts.onFail&&i.opts.onFail()})),addEvent(t,"canplay",(function(){i._prefetchAudioEl,i._currentAudioEl==t&&(i.opts.onCanPlay&&i.opts.onCanPlay(),i._seekOnReady&&(i.seek(i._seekOnReady),i._seekOnReady=!1))})),e&&(this._setAudioNodeUrl(t,e),t.preload="auto",t.volume=this._volume||1,t.load()),this._audioNodes.push(t),t}onReady(e){e(!0)}prefetch(e){this._prefetchAudioEl&&this._setAudioNodeUrl(this._prefetchAudioEl,Dt),this._prefetchAudioEl=this._createAudioNode(e)}seek(e){var t=this._currentAudioEl;this.duration?t.currentTime=this.duration*e:this._seekOnReady=e}setVolume(e){void 0===e&&(e=this._currentAudioEl.volume),this._currentAudioEl.volume=e,this._prefetchAudioEl&&(this._prefetchAudioEl.volume=e),this._volume=e}_isInvalidDuration(){var e=this._currentAudioEl;return isNaN(e.duration)||e.duration==1/0||0==e.duration}get duration(){var e=this._currentAudioEl,t=isNaN(e.duration)||e.duration==1/0?0:e.duration;return!t&&this._trackOptions.duration&&(t=parseInt(this._trackOptions.duration)),t}getCurrentProgress(){var e=this._currentAudioEl;return this.duration?Math.max(0,Math.min(1,e.currentTime/this.duration)):0}getCurrentBuffered(){var e=this._currentAudioEl;return e&&e.buffered.length?Math.min(1,e.buffered.end(0)/e.duration):0}isFullyLoaded(){return this._currentAudioEl._fullyLoaded}setUrl(e,t){var i=this._currentAudioEl;if(this._seekOnReady=!1,this._trackOptions={},t&&"object"==typeof t&&(this._trackOptions=t,t=t.callback),i.src==e)return this.opts.onCanPlay&&this.opts.onCanPlay(),t&&t(!0);if(this._prefetchAudioEl&&this._prefetchAudioEl.readyState>Ut.STATE_HAVE_NOTHING)if(this._prefetchAudioEl.src==e){this._currentAudioEl.pause(0),this._setAudioNodeUrl(this._currentAudioEl,Dt);var a=this;this._prefetchAudioEl.readyState>=Ut.STATE_HAVE_FUTURE_DATA&&setTimeout((function(){a.opts.onCanPlay&&a.opts.onCanPlay()})),i=this._currentAudioEl=this._prefetchAudioEl,this._prefetchAudioEl=!1}else this._prefetchAudioEl.src&&this._setAudioNodeUrl(this._prefetchAudioEl,Dt);return i.src!=e&&(this._setAudioNodeUrl(i,e),i.load()),t&&t(!0)}play(e){this._prefetchAudioEl.src==e&&this._prefetchAudioEl.readyState>Ut.STATE_HAVE_NOTHING&&(this._setAudioNodeUrl(this._currentAudioEl,Dt),this._currentAudioEl=this._prefetchAudioEl,this._prefetchAudioEl=this._createAudioNode(),this.opts.onCanPlay&&this.opts.onCanPlay());var t=this._currentAudioEl;t.src&&G(t).catch((()=>{console.log("Audio: url set failed (html5 impl)")}))}pause(){var e=this._currentAudioEl;e.src&&e.pause()}stop(){var e=this._currentAudioEl;this._setAudioNodeUrl(e,Dt)}_setFadeVolumeInterval(e){if(e){if(!this._fadeVolumeWorker&&window.Worker&&window.Blob){var t=new Blob(["\n        var interval;\n        onmessage = function(e) {\n          clearInterval(interval);\n          if (e.data == 'start') {\n            interval = setInterval(function() { postMessage({}); }, 20);\n          }\n        }\n      "]);try{this._fadeVolumeWorker=new Worker(window.URL.createObjectURL(t))}catch(e){this._fadeVolumeWorker=!1}}this._fadeVolumeWorker?(this._fadeVolumeWorker.onmessage=e,this._fadeVolumeWorker.postMessage("start")):this._fadeVolumeInterval=setInterval(e,60)}else this._fadeVolumeWorker&&(this._fadeVolumeWorker.terminate(),this._fadeVolumeWorker=null),this._fadeVolumeInterval&&clearInterval(this._fadeVolumeInterval)}fadeVolume(e,t){e=Math.max(0,Math.min(1,e));var i=this._currentAudioEl,a=0;if(a=e<i.volume?-.04:.001,Math.abs(e-i.volume)<=.001)return this._setFadeVolumeInterval(),t&&t();var n=i.volume;this._setFadeVolumeInterval(function(){a>0&&(a*=1.2),n+=a;if(a<0?n<=e:n>=e)return this.setVolume(e),this._setFadeVolumeInterval(),t&&t();this.setVolume(n)}.bind(this))}}Ut.STATE_HAVE_NOTHING=0,Ut.STATE_HAVE_FUTURE_DATA=3,Ut.HAVE_ENOUGH_DATA=4,Ut.AUDIO_EL_ID="ap_audio";class Rt{constructor(e){this.opts=e||{},window._flashVoiceInstance=this}fadeVolume(e,t){return this.setVolume(e),t()}get type(){return"flash"}destroy(){var e=document.getElementById(Rt.PLAYER_EL_ID);e&&e.remove()}get loaded(){return!!this._player}onReady(e){if(this._player)return e(!0);if(!1===this._player)return e(!1);this._onReady=e;if(!document.getElementById(Rt.PLAYER_EL_ID)){var t=document.body.appendChild(document.createElement("div"));t.id=Rt.PLAYER_EL_ID,t.className="fixed"}var i=this;renderFlash(Rt.PLAYER_EL_ID,{url:"/swf/audio_lite.swf",id:"flash_voice_player",height:2},{swliveconnect:"true",allowscriptaccess:"always",wmode:"opaque"},{onPlayFinish:"VoicePlayerFlash.onAudioFinishCallback",onLoadProgress:"VoicePlayerFlash.onAudioLoadProgressCallback",onPlayProgress:"VoicePlayerFlash.onAudioProgressCallback"})&&setTimeout((function(){i._checkFlashLoaded()}),50)}setUrl(e,t){this._trackOptions={},t&&"object"==typeof t&&(this._trackOptions=t,t=t.callback),this._url!=e?(this._url=e,this._player&&this._player.loadAudio(e),t&&t(!0)):t&&t(!0)}setVolume(e){this._player&&this._player.setVolume&&this._player.setVolume(e)}play(){this._player&&this._player.playAudio()}seek(e){var t=(this._total||0)*e;this._player&&this._player.playAudio(t)}pause(){this._player&&this._player.pauseAudio()}isFullyLoaded(){return!1}getPlayedTime(){return 0}getCurrentProgress(){return this._currProgress||0}getCurrentBuffered(){return this._currBuffered||0}stop(){this._player&&this._player.stopAudio()}_checkFlashLoaded(){var e=document.getElementById("flash_voice_player");if(this._checks=this._checks||0,this._checks++,this._checks>10){this._player=!1;var t=this._onReady;return t&&t(!1)}if(e&&e.paused){this._player=e;var i=this._onReady;i&&i(!0),this._onReady=null}else{var a=this;setTimeout((function(){a._checkFlashLoaded()}),100)}}static onAudioFinishCallback(){var e=window._flashVoiceInstance;e.opts.onEnd&&e.opts.onEnd()}static onAudioProgressCallback(e,t){var i=window._flashVoiceInstance;t&&(i._total=t,i._currProgress=e/t,i.opts.onProgressUpdate&&i.opts.onProgressUpdate(i._currProgress))}static onAudioLoadProgressCallback(e,t){var i=window._flashVoiceInstance;i._currBuffered=e/t,i.opts.onBufferUpdate&&i.opts.onBufferUpdate(i._currBuffered)}}window.VoicePlayerFlash=Rt,Rt.PLAYER_EL_ID="flash_voice";void 0===window.isTouch&&(window.isTouch=!1);class Nt{constructor(e,t){if(!e)throw new Error("No element was provided for Slider");e="string"==typeof e||"number"==typeof e?document.getElementById(e):e,this.options=t||{size:1},void 0===this.options.logfbase&&(this.options.logfbase=35),this.options.backValue=this.options.backValue||0;var i=100*this.options.backValue,a='<div class="slider_slide">\n        <div class="slider_loading_bar" style="opacity: 0; display: none;"></div>\n        '+(this.options.withBackLine?'<div class="slider_back" style="width:'+i+'%"></div>':"")+'\n        <div class="slider_amount '+(this.options.useClippedPathProgress?"slider_amount--clipped":"")+'"></div>\n        <div class="slider_handler"></div>\n      </div>';this._el=document.createElement("div"),this._el.innerHTML=a,this._el.id=e.getAttribute("id")||"",this._el.className="slider";var n=this;if(e.classList)for(var s=e.classList,o=0,r=s.length;o<r;o++)this._el.classList.add(s[o]);else this._el.className=e.className;(0,_.each)(this._el.attributes,(function(e,t){"id"==t.name&&"class"==t.name||n._el.setAttribute(t.name,t.value)})),e.parentNode.replaceChild(this._el,e),this._amountEl=this._el.querySelector(".slider_amount"),this._handlerEl=this._el.querySelector(".slider_handler"),this._slideEl=this._el.querySelector(".slider_slide"),this._backEl=this._el.querySelector(".slider_back"),this._progressEl=this._el.querySelector(".slider_loading_bar"),this.options.color&&(window.setStyle(this._amountEl,{backgroundColor:this.options.color}),window.setStyle(this._handlerEl,{backgroundColor:this.options.color})),this.options.backColor&&window.setStyle(this._slideEl,{backgroundColor:this.options.backColor}),this._el.classList.add("slider_size_"+this.options.size),this.options.debounce&&(this._onValueChangeDebounced=(0,ue.debounce)(this._onValueChange,this.options.debounce)),!isTouch&&t.formatHint&&(addEvent(this._el,"mousemove",this._ev_onMouseOver=this._onMouseOver.bind(this)),addEvent(this._el,"mouseleave",this._ev_onMouseLeave=this._onMouseLeave.bind(this))),addEvent(this._el,isTouch?"touchstart":"mousedown",this._ev_onMouseDown=this._onMouseDown.bind(this)),addEvent(this._el,"click",cancelEvent),this.setValue(this.options.value||0,!this.options.fireChangeEventOnInit,!1),this.setBackValue(this.options.backValue)}toggleLoading(e){e=!!e,window.toggle(this._progressEl,e),window.setStyle(this._progressEl,"opacity",e?1:0)}destroy(){!isTouch&&this.options.formatHint&&(removeEvent(this._el,"mousemove",this._ev_onMouseOver),removeEvent(this._el,"mouseleave",this._ev_onMouseLeave),removeEvent(this._el,"mousedown",this._ev_onMouseDown));var e=window.re||window.remove;e(this._el),e(this._currHintEl)}_updateHint(e,t){if(!this._currHintEl){var i=document.createElement("div");i.className="slider_hint",i.id="slider_hint",this._currHintEl=i,this.options.hintClass&&this._currHintEl.classList.add(this.options.hintClass),this._el.appendChild(this._currHintEl)}var a=this._getPos(),n=Math.round((e.pageX||e.touches[0].pageX)-a[0]),s=this._width;if((n=t?Math.min(Math.max(0,n),s):n)>=0&&n<=s){var o=n/s;this._currHintEl.innerHTML=this.options.formatHint?this.options.formatHint.call(this,o):o;var r=this._currHintEl.getBoundingClientRect();window.setStyle(this._currHintEl,{left:this._slideEl.offsetLeft+n-(r.right-r.left)/2,top:this._slideEl.offsetTop-(r.bottom-r.top)-10}),!t&&this._toggleHint(!0)}else!t&&this._toggleHint(!1);this.options.formatHint||this._toggleHint(!1)}_toggleHint(e){this._currHintEl&&this._currHintEl.classList.toggle("visible",e)}_onMouseOver(e){Nt._currenSliderDrag||this._el.classList.contains("active")||this._updateHint(e)}_onMouseLeave(e){this._el.classList.contains("active")||this._toggleHint(!1)}get _width(){if(!this._widthCache){var e=this._el.getBoundingClientRect();this._widthCache=e.right-e.left}return this._widthCache}_onMouseDown(e){(0==e.button||e.touches)&&(delete cur._sliderMouseUpNowEl,addEvent(window,isTouch?"touchmove":"mousemove",this._ev_onMouseMove=this._onMouseMove.bind(this)),addEvent(window,isTouch?"touchend touchcancel":"mouseup",this._ev_onMouseUp=this._onMouseUp.bind(this)),this._onMouseMove(e),Nt._currenSliderDrag=this,this._el.classList.add("active"),cancelEvent(e))}_onMouseUp(e){cur._sliderMouseUpNowEl=this._el,removeEvent(window,isTouch?"touchmove":"mousemove",this._ev_onMouseMove),removeEvent(window,isTouch?"touchend touchcancel":"mouseup",this._ev_onMouseUp),this._onValueChange(),this._el.classList.remove("active"),Nt._currenSliderDrag=!1,this._toggleHint(!1),this.options.onEndDragging&&this.options.onEndDragging(this._currValue),cancelEvent(e)}_onMouseMove(e){var t=this._getPos(),i=t[0];i=void 0!==e.touches&&e.touches.length>0?e.touches[0].pageX:e.pageX,i=Math.max(i,t[0]),i=Math.min(i,t[0]+this._width),i-=t[0],this.setValue(i/this._width,!0,!0),this._onValueChangeDebounced?this._onValueChangeDebounced():this._onValueChange(),this._toggleHint(!0),this._updateHint(e,!0),cancelEvent(e)}_getPos(){return this._slidePos=window.getXY(this._slideEl)}_logf(e){if(!this.options.log)return e;var t=this.options.logfbase;return(Math.pow(t,e)-1)/(t-1)}_unlogf(e){if(!this.options.log)return e;var t,i,a=this.options.logfbase;return t=a,i=1+e*(a-1),Math.log(i)/Math.log(t)}setValue(e,t,i){if(!this._el||!this._el.classList.contains("active")||i){var a=i?this._logf(e):e;if(this._currValue!=a){this._currValue=a;var n=i?e:this._unlogf(e),s=100*n+"%";this.options.useClippedPathProgress?window.setStyle(this._amountEl,{clipPath:"inset(0 "+100*(1-n)+"% 0 0)"}):window.setStyle(this._amountEl,{width:s}),window.setStyle(this._handlerEl,{left:s}),!t&&this._onValueChange()}}}setBackValue(e){this._backEl&&this._backEl.classList.toggle("slider_back_transition",e>this._backValue),this._backValue=e;var t=100*e+"%";window.setStyle(this._backEl,{width:t})}_onValueChange(){this._lastValue=this._lastValue||0,this._lastValue!=this._currValue&&(this._lastValue=this._currValue,this.options.onChange&&this.options.onChange(this._currValue))}}var Bt,xt=i(83609),Ht=!1;class Ft{constructor(e){var{onListened:t,onInit:i,voiceMessageHTML:a,onPlay:n,onPause:s,onEnd:o}=void 0===e?{}:e;this._reattach=!1,this._audioEl=null,this._playing=!1,this._timer=null,this._duration=0,this._detaching=!1,this._html=a,this._initCallback=i,this._playCallback=n,this._pauseCallback=s,this._endCallback=o;var r={onEnd:()=>{this._endCallback&&this._audioEl&&this._endCallback(this._audioEl),this.detach()},onFail:()=>{this.detach()},onCanPlay:()=>{},onProgressUpdate:e=>{this._updateProgress(e)}};Bt=!1,Ut.isSupported()?(Ut.isSupported('audio/ogg;codecs="opus"')&&!Ut.isSupported('audio/ogg;codecs="codec_check"')&&(Bt=!0),this._impl=new Ut(r)):f.browser.flash&&window.renderFlash&&(this._impl=new Rt(r)),this.onPlayPause=e=>(cancelEvent(e),this._clearMediaSession(),this.toggle()),this.onDurationClick=e=>{this.durationType=!this.durationType,cancelEvent(e)},this._onListened=()=>{t&&t(this._audioEl)},this._initEvents()}_updateProgress(e){this._audioEl&&(this._duration*e>=1||this._duration<1)&&!this._audioEl._listened&&(this._audioEl._listened=!0,this._onListened()),this._durationEl&&(this.durationType?this._durationEl.innerHTML="-"+(0,xt.formatTime)(Math.round(this._duration*(1-e))):this._durationEl.innerHTML=(0,xt.formatTime)(Math.round(this._duration*e))),this._progressSlider&&this._progressSlider.setValue(e)}get type(){return this._impl.type}get durationType(){return window.AudioPlayer?!!K.default.get(AudioPlayer.LS_PREFIX+AudioPlayer.LS_DURATION_TYPE):"1"==K.default.get("audio_time_left")}set durationType(e){window.AudioPlayer?K.default.set(AudioPlayer.LS_PREFIX+AudioPlayer.LS_DURATION_TYPE,!!e):K.default.set("audio_time_left",e?"1":"0")}_initInterface(){var e=document.createElement("div");e.innerHTML=this._html,this._el=e.firstChild,window.getLang&&this._el.setAttribute("aria-label",getLang("mail_audio_message")),this._playBtn=this._el.querySelector(".audio-msg-track--btn");var t=this._audioEl.getAttribute("id");if(t&&this._el.setAttribute("id","vmp_"+t),this._audioEl.classList.contains("audio-msg-track--preview")){this._el.classList.add("audio-msg-track--preview"),this._playBtn.classList.add("audio-msg-track--btnSvg");var i=this._audioEl.querySelector(".audio-msg-track--btn");this._playBtn.innerHTML=i.innerHTML}window.getLang&&this._playBtn.setAttribute("aria-label",getLang("global_audio_play")),this._durationEl=this._el.querySelector(".audio-msg-track--duration"),this._durationEl.innerHTML=(0,xt.formatTime)(this._duration),this._progressSlider=new Nt(this._el.querySelector(".audio-msg-track--slider"),{value:0,useClippedPathProgress:!0,hintClass:"audio_player_hint",formatHint:e=>(0,xt.formatTime)(Math.round(e*this._duration)),onEndDragging:e=>{this._impl.seek(e)}});var a=this._audioEl.querySelector(".audio-msg-track--wave-wrapper").children[0];this._el.querySelector(".slider_slide").appendChild(a.cloneNode(!0)),this._el.querySelector(".slider_amount").appendChild(a.cloneNode(!0)),addEvent(this._playBtn,"click",this.onPlayPause),addEvent(this._durationEl,"click",this.onDurationClick),this._initCallback&&this._initCallback(this._audioEl,this._el),this._audioEl.parentNode.prepend(this._el),this._clearMediaSession()}_clearMediaSession(){lt&&(navigator.mediaSession.setActionHandler("play",(()=>this.play())),navigator.mediaSession.setActionHandler("pause",(()=>this.pause())),navigator.mediaSession.setActionHandler("seekbackward",null),navigator.mediaSession.setActionHandler("seekforward",null),navigator.mediaSession.setActionHandler("previoustrack",null),navigator.mediaSession.setActionHandler("nexttrack",null),navigator.mediaSession.metadata=new MediaMetadata({title:"",artist:"",album:"",artwork:[]}))}_destroyInterface(){window.hide(this._el),this._audioEl.parentNode&&this._audioEl.parentNode.contains(this._el)&&this._audioEl.parentNode.removeChild(this._el),removeEvent(this._playBtn,"click",this.onPlayPause),this._progressSlider&&(this._progressSlider.destroy(),this._progressSlider=null),this._playBtn=null,this._durationEl=null,this._el=null}attachTo(e){if(this._audioEl!==e){null!=this._audioEl&&(this._reattach=!0),this.detach(),this._audioEl=e,this._audioEl.classList.add("audio-msg-track_player-attached"),this._duration=e.getAttribute("data-duration"),this._initInterface();var t=this._audioEl.id.split("_");t&&t.length>1&&(this._owner_id=t[1]),this._reattach=!1;var i=e.getAttribute(Bt?"data-ogg":"data-mp3");if(!this._impl.loaded)return new Promise(((e,t)=>{this._impl.onReady((()=>{this._impl.setUrl(i,{duration:this._duration,callback:e})}))}));this._impl.setUrl(i,{duration:this._duration})}return!0}detach(e){if(void 0===e&&(e=!1),this._audioEl&&this._el&&!this._detaching){if(e&&this.isAttached())return;this._detaching=!0,this.stop(),this._destroyInterface(),this._audioEl.classList.remove("audio-msg-track_player-attached"),this._audioEl._listened=!1,this._audioEl=null}this._detaching=!1}play(){this._audioEl&&(this._reattach||Ft.pauseGlobalMedia(),this._el&&this._el.classList.add("audio-msg-track_playing"),this._playBtn&&window.getLang&&this._playBtn.setAttribute("aria-label",getLang("global_audio_pause")),this._playing=!0,this._createTimer(),this._owner_id&&(0,y.statlogsValueEvent)("audio_message_play",this._owner_id),this._playCallback&&this._playCallback(this._audioEl),this._impl.play())}pause(){this._audioEl&&(!this._reattach&&this._playing&&Ft.resumeGlobalMedia(),this._playBtn&&window.getLang&&this._playBtn.setAttribute("aria-label",getLang("global_audio_play")),this._el&&this._el.classList.remove("audio-msg-track_playing"),this._playing=!1,this._impl.pause(),this._killTimer())}stop(){this.pause(),this._impl.stop()}toggle(){this._playing?(this.pause(),this._pauseCallback&&this._pauseCallback(this._audioEl)):this.play()}_createTimer(){this._duration>0&&(this._killTimer(),this._timer=setInterval((()=>{if(this._impl){var e=this._impl.getCurrentProgress();this._updateProgress(e)}}),100))}_killTimer(){this._timer&&(clearInterval(this._timer),this._timer=null)}_initEvents(){window.ap?window.ap.on(this,[v.events.PLAY_REQUESTED,v.events.PLAY],(()=>{delete window.ap.pausedByMsg,this.pause()})):window.audio&&window.audio.subscribe([v.events.PLAY_REQUESTED,v.events.PLAY],(()=>{delete window.audio.pausedByMsg,this.pause()})),window.Notifier&&(window.Notifier.addRecvClbk("audio_start","audio_msg",(()=>{this.pause()})),window.Notifier.addRecvClbk("video_start","audio_msg",(()=>{this.pause()})))}isAttached(){if(this._audioEl){for(var e=this._audioEl;e.parentNode;)e=e.parentNode;return!!e.body}return!1}static pauseGlobalMedia(){window.Notifier&&(Ht=!0,window.Notifier.lcSend("video_start")),window.ap&&window.ap.isPlaying()?(window.ap.pause(),window.ap.pausedByMsg=!0):window.audio&&window.audio.playing&&window.audio.playing()&&(window.audio.pause(),window.audio.pausedByMsg=!0)}static resumeGlobalMedia(){window.Notifier&&Ht&&(Ht=!1,window.Notifier.lcSend("video_hide")),window.ap&&window.ap.pausedByMsg?(window.ap.play(),delete window.ap.pausedByMsg):window.audio&&window.audio.playing&&window.audio.pausedByMsg&&(G(window.audio).catch((()=>{})),delete window.audio.pausedByMsg)}}var Vt=i(22899),Yt=null;function qt(e){for(var t=geByClass("audio-msg-track--wave-wrapper",e),i=(0,le.$)(".audio-msg-track__transcriptionButton",e),a=0,n=0;n<t.length;n++){try{var s=i&&parseInt(window.getComputedStyle(i,null).getPropertyValue("width"))||0;a=parseInt(window.getComputedStyle(t[n],null).getPropertyValue("width"))-s-8}catch(e){var o=i&&parseInt(i.currentStyle.width)||0;a=parseInt(t[n].currentStyle.width)-o-8}if(a>0)break}return a}function Xt(e,t){t=Math.round(t),e.length!=t&&(e=(0,Vt.fastResample)(e,t));for(var i="",a=0,n=0;n<e.length;n++)0===(a=Math.floor(7.5*e[n]*.95))&&(a=.5),i+="M"+(4*n+1)+","+(10-a)+"v"+2*a+"Z";return'<svg class="audio-msg-track--wave" width="'+4*e.length+'px"><path d="'+i+'"></path></svg>'}function jt(){for(var e=geByClass("audio-msg-track"),t=0;t<e.length;t++){var i=(0,A.attr)(e[t],"data-wave");if((0,A.hasClass)(e[t],"audio-msg-player")&&t>0){var a=e[t].getAttribute("id");if(a.startsWith("vmp_")){var n=document.getElementById(a.replace("vmp_",""));i=(0,A.attr)(n,"data-wave")}else i=(0,A.attr)(e[t-1],"data-wave")}var s=qt(e[t]);if(i&&s){i=i.split(",");for(var o=geByClass("audio-msg-track--wave",e[t]),r=Xt(i,s/4),l=0;l<o.length;l++){var u=(0,A.ce)("div",{innerHTML:r}).firstChild;o[l].parentNode.replaceChild(u,o[l])}}}}addEvent(window,"orientationchange",(()=>setTimeout(jt,500))),window.mail&&window.mail.onMessagesRepainted&&(onDOMReady(jt),window.mail.onMessagesRepainted(jt));function Wt(){return Yt||(Yt=new Ft({onListened:e=>{AudioMessagePlayer.events.emit("listened",e)},onInit:(e,t)=>{var i=geByClass1("audio-msg-track--wave-wrapper",t),a=geByClass1("audio-msg-track__transcriptionButton",e),n=geByClass1("audio-msg-track__after",e);n&&a&&(i.appendChild(a.cloneNode(!0)),t.appendChild(n.cloneNode(!0)),t.setAttribute("data-transcription-expanded",e.getAttribute("data-transcription-expanded")))},voiceMessageHTML:'<div class="audio-msg-player audio-msg-track"><button class="audio-msg-track--btn"></button><div class="audio-msg-track--wave-wrapper"><div class="audio-msg-track--slider"></div></div><div class="audio-msg-track--duration"></div></div>'})),Yt}window.AudioMessagePlayer={loaded:!0,events:new EventEmitter,togglePlay:function(e,t,i){void 0===i&&(i=null);var a=Wt(),n=a.attachTo(e),s=()=>{null!==i?i?a.play():a.pause():a.play()};!0===n?s():n.then((()=>{s()}))},detachPlayer:function(e){Wt().detach(e)},getAttachedTrackPlayer:()=>(0,le.$)(".audio-msg-track_player-attached"),pauseGlobalMedia:function(){Ft.pauseGlobalMedia()},resumeGlobalMedia:function(){Ft.resumeGlobalMedia()},redrawWaves:jt,getWave:Xt,toggleTranscription(e,t,i){void 0===t&&(t=null),void 0===i&&(i=null),e&&(e.preventDefault(),e.stopPropagation());var a=t||e.target,n=a.closest(".audio-msg-player"),s=n?n.parentNode.querySelector("#"+n.id.replace("vmp_","")):a.closest(".audio-msg-track"),o=n?(0,le.$)(".audio-msg-track__transcriptionButton",s):a,r=null===i?"true"===o.getAttribute("aria-expanded"):!i;a.setAttribute("aria-expanded",r?"false":"true"),n&&o.setAttribute("aria-expanded",r?"false":"true"),s.setAttribute("data-transcription-expanded",r?"false":"true"),n&&n.setAttribute("data-transcription-expanded",r?"false":"true"),this.events.emit("transcription_toggle",!r,s)}};var zt=i(41313);(0,zt.onServerEvent)("Audio/init").watch((function(e){se.init(e)})),(0,zt.onServerEvent)("AudioPlayer/init").watch((function(e){pt.init(e)})),(0,zt.onServerEvent)("AudioSection/init_scroll").watch((function(e){(0,A.autoScroll)((function(){var t=document.querySelector(".mcont"),i=null==t?void 0:t.querySelector("."+e.className);return i&&!i.dataset.disabled?i:null}),vt,{delta:500,no_cache:!0})}))},97349:function(e,t,i){"use strict";i.d(t,{Unauthorized:function(){return f},getOpenInAppMyTrackerUrl:function(){return v}});var a=i(85677),n=i(9223),s=i(39871),o=i(40517),r=i(79654),l=i(71437),u=i(76567);function d(e,t){if(c(),e){var i=function(t){r.marketingTransitionItemStat.logEvent(o.MarketingTransitionItemCampaignType.UNAUTH_ACTION_BOX,t,e.unauth_action_box.action,window.location.href)},u=(0,a.UnauthorizedActionModal)({type:e.unauth_action_box.action,iconType:e.unauth_action_box.icon_type,iconUrl:e.unauth_action_box.icon_url,title:e.unauth_action_box.header,description:e.unauth_action_box.text,loginUrl:e.sign_in_url,joinUrl:e.sign_up_url,showOpenInApp:e.show_open_in_app,openInAppUrl:e.open_in_app_url}),d=(0,n.default)({body:u}),h=!1,_=function(){h||t&&t(),i(o.MarketingTransitionItemEventType.CLOSE)};(0,n.open)(s.default.elem(d),!0,"",{onClose:function(){_()},onOverlayClick:function(){setTimeout((function(){return _()}),500)}});var p=(0,l.$)(".UnauthorizedActionModal__openInAppButton"),f=(0,l.$)(".UnauthorizedActionModal__signInTextLink"),g=(0,l.$)(".UnauthorizedActionModal__signUpTextLink"),y=(0,l.$)('.UnauthorizedActionModal .Btn[data-type="login"]'),m=(0,l.$)('.UnauthorizedActionModal .Btn[data-type="join"]'),E=function(e){window.ModalMenu.close(e)},A=function(e,t){var a=e.target;h=!0,i(t),E(a),e.preventDefault(),e.stopPropagation(),setTimeout((function(){return window.nav.go(a)}),110)};[y,f].forEach((function(e){null==e||e.addEventListener("click",(function(e){A(e,o.MarketingTransitionItemEventType.CLICK_SIGN_IN)}))})),[m,g].forEach((function(e){null==e||e.addEventListener("click",(function(e){A(e,o.MarketingTransitionItemEventType.CLICK_SIGN_UP)}))})),null==p||p.addEventListener("click",(function(e){var t=e.target;h=!0,i(o.MarketingTransitionItemEventType.CLICK_OPEN_IN_APP),E(t),e.preventDefault(),e.stopPropagation();var a=t.getAttribute("href");if(a){var n=v(a);setTimeout((function(){return window.nav.go(n)}),110)}})),i(o.MarketingTransitionItemEventType.OPEN)}}function c(){window.ajax.post("/?act=get_unauth_action_box",{_ajax:1,write_ab:1})}var h,_=0,p=!1;var f={onActionClick:function(e,t,i){var a;(null===(a=window.UnauthorizedFeed)||void 0===a?void 0:a.isActive)?window.UnauthorizedFeed.onAction(e,t):window.vk.id||(null==e||e.preventDefault(),window.ajax.post("/?act=get_unauth_action_box",{_ajax:1,action:t,object:i,to:window.location.href.replace(window.location.origin,"")},{onDone:function(e){e.unauth_action_box&&d(e)}}))},onMoreBoxActionClick:function(e,t){e&&(t&&r.marketingTransitionItemStat.logEvent(o.MarketingTransitionItemCampaignType.UNAUTH_ACTION_BOX,t,o.MarketingTransitionItemSourceType.MORE,window.location.href),e.preventDefault(),e.stopPropagation(),setTimeout((function(){return window.nav.go(e.target)}),110))},initScrollMoreBox:function(e){var t,i=function(){p=!1,window.removeEventListener("scroll",h)};i(),_=Date.now(),h=function(){p||Date.now()-_<2e3||(window.cur.unauthScrollMoreBox||window.pageYOffset>=2*window.innerHeight&&(p=!0,d(e)))},window.addEventListener("scroll",h),null===(t=window.cur.destroy)||void 0===t||t.push((function(){return i()}))},showMoreBox:function(e,t,i,a){e&&e.preventDefault(),c(),window.ajax.post("/?act=get_unauth_action_box",{_ajax:1,action:"more",owner_id:t,source:i,to:window.location.href.replace(window.location.origin,"")},{loader:!0,onDone:function(e){e.unauth_action_box&&d(e,a)}})},writeUnauhActionBoxABGroup:c};function v(e){var t=e.includes("?")?"&":"?";return""+e+t+"unauth_id="+(0,u.getCookie)("remixstid")+"&target_url="+encodeURIComponent(window.location.href)}},12334:function(e,t,i){"use strict";function a(e){var t=e.split(" "),i=(t=t.slice(0,t.length-1)).join(" ");return i&&(i+="..."),i}function n(e,t){if(void 0===t&&(t=0),e.scrollHeight/e.clientHeight>1.1)for(var i=e.clientHeight,n=e.innerText;n&&e.scrollHeight/i>1.1&&e.innerText.split(" ").length>t;)n=a(n),e.innerHTML=n}i.d(t,{truncateMultilineText:function(){return n}})},83609:function(e,t,i){"use strict";function a(e,t){var i;e=Math.max(e,0);var a=Math.floor(e%60);i=a<10?"0"+a:a;var n=(e=Math.floor(e/60))%60;return i=n+":"+i,((e=Math.floor(e/60))>0||t)&&(n<10&&(i="0"+i),i=e+":"+i),i}i.d(t,{formatTime:function(){return a}})},59866:function(e,t,i){"use strict";i.d(t,{UnauthorizedSourceType:function(){return a}});var a={PHOTO:"photo",VIDEO:"video",AUDIO:"audio",COMMENTS:"comments"}}},function(e){"use strict";e.O(0,[4578,4736,1777,5456,5790,3898,5411,6855,6199,490,410,6444,8592,7219,6429],(function(){return t=5309,e(e.s=t);var t}));e.O()}]);